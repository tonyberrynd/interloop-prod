"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};agGrid.LicenseManager.setLicenseKey("Interloop_Interloop_1Devs_06-Jun-2016_MTQ5NjcwMzYwMDAwMA==ef33ffeb776021021801f22d7b1b9d91"),agGrid.initialiseAgGridWithAngular1(angular),angular.module("interloop",["ngResource","ngAnimate","ui.router","ct.ui.router.extras","ngSanitize","ui.mask","ui.bootstrap","toastr","agGrid","lbServices","ngTagsInput","ngCsv","checklist-model","ui.select","daterangepicker","angular.filter","pusher-angular","cfp.hotkeys","ngCountTo","angular-ladda","angular-cache","mentio","ui.sortable","nya.bootstrap.select","angular-web-notification","angular-stripe","validation.match","ngPasswordStrength","infinite-scroll","slick","ngFileUpload","tandibar/ng-rollbar","ngIntercom","interloop.value.config","interloop.value.fields","interloop.value.permissions","interloop.value.modalDefs","interloop.config","interloop.routes","interloop.routes.settings","interloop.loginCtrl","interloop.forgotCtrl","interloop.resetCtrl","interloop.navCtrl","interloop.analyticsCtrl","interloop.forecastingCtrl","interloop.opportunitiesCtrl","interloop.companiesCtrl","interloop.contactsCtrl","interloop.activitiesCtrl","interloop.notificationsCtrl","interloop.testCtrl","interloop.homeCtrl","interloop.componentsCtrl","interloop.sidebarOpportunityCtrl","interloop.directoryCtrl","interloop.userCtrl","interloop.myFilesCtrl","interloop.myStarredCtrl","interloop.inviteUsersCtrl","interloop.newActivityCtrl","interloop.newNoteCtrl","interloop.newOpportunityCtrl","interloop.newContactCtrl","interloop.newCompanyCtrl","interloop.fileUploadCtrl","interloop.wonReasonCtrl","interloop.lostReasonCtrl","interloop.createViewCtrl","interloop.editViewCtrl","interloop.deleteViewCtrl","interloop.bulkAssignCtrl","interloop.bulkDeleteCtrl","interloop.bulkEditCtrl","interloop.bulkTagCtrl","interloop.exportDataCtrl","interloop.importDataCtrl","interloop.manageTagsCtrl","interloop.confirmCtrl","interloop.settingsProfileCtrl","interloop.settingsNotificationsCtrl","interloop.settingsConnectedCtrl","interloop.settingsCompanyCtrl","interloop.settingsUsersCtrl","interloop.settingsPermissionsCtrl","interloop.settingsTeamsCtrl","interloop.settingsIntegrationsCtrl","interloop.settingsSubscriptionCtrl","interloop.settingsInvoicesCtrl","interloop.settingsFieldsCtrl","interloop.settingsViewsCtrl","interloop.settingsTagsCtrl","interloop.directive.permission","interloop.directive.dynamicTitle","interloop.directive.autofocus","interloop.filter.formatDate","interloop.filter.megaNumber","interloop.factory.configService","interloop.factory.authService","interloop.factory.newEntityFactory","interloop.factory.modalManager","interloop.factory.viewManager","interloop.factory.gridManager","interloop.factory.queryBuilder","interloop.factory.sidebarRouter","interloop.factory.sidebarActions","interloop.factory.relationshipManager","interloop.factory.searchService","interloop.factory.logger"]),angular.module("interloop.value.config",[]).value("entityTypes",{activity:{singular:"Activity",plural:"Activities"},opportunity:{singular:"Opportunity",plural:"Opportunities"},contact:{singular:"Contact",plural:"Contacts"},company:{singular:"Company",plural:"Companies"}}).value("searchEntities",{opportunity:{singular:"Opportunity",plural:"Opportunities"},contact:{singular:"Contact",plural:"Contacts"},company:{singular:"Company",plural:"Companies"},attachment:{singular:"Attachment",plural:"Attachments"}}).value("companyTypes",[{key:"linkedIn",label:"LinkedIn",icon:"fa fa-linkedin-square"},{key:"twitter",label:"Twitter",icon:"fa fa-twitter-square"},{key:"facebook",label:"Facebook",icon:"fa fa-facebook-square"}]).value("contacTypes",[{key:"linkedIn",label:"LinkedIn",icon:"fa fa-linkedin-square"},{key:"twitter",label:"Twitter",icon:"fa fa-twitter-square"},{key:"facebook",label:"Facebook",icon:"fa fa-facebook-square"}]).value("socialTypes",[{key:"linkedIn",label:"LinkedIn",icon:"fa fa-linkedin-square"},{key:"twitter",label:"Twitter",icon:"fa fa-twitter-square"},{key:"facebook",label:"Facebook",icon:"fa fa-facebook-square"}]).value("emailTypes",[{key:"work",label:"Work"},{key:"personal",label:"Personal"},{key:"other",label:"Other"}]).value("phoneTypes",[{key:"work",label:"Work"},{key:"personal",label:"Personal"},{key:"other",label:"Other"}]).value("EXCLUDE-Opportunity",{process:!1}).value("INCLUDE-Opportunity",[""]),angular.module("interloop.value.fields",[]).constant("ActivityFields",{name:{label:"Name",field:"name",type:"string",locked:!0,excludeGrid:!1,hide:!1,width:300,valueGetter:null,cellRenderer:null,pinned:!0},description:{label:"Description",field:"description",type:"string",excludeGrid:!0,hide:!1,width:300,valueGetter:null,cellRenderer:null,pinned:!1},type:{label:"Type",field:"type",type:"category",excludeGrid:!1,hide:!1,width:300,valueGetter:"getNestedValue",cellRenderer:null,pinned:!1},owner:{label:"Owner",field:"owner",type:"string",excludeGrid:!1,hide:!1,width:300,valueGetter:"getNestedOwner",cellRenderer:null,pinned:!1},relatedTo:{label:"Related To",field:"relatedTo",type:"array",excludeGrid:!1,hide:!1,width:300,valueGetter:null,cellRenderer:"dateRender",pinned:!1},dueDate:{label:"Due Date",field:"dueDate",type:"date",excludeGrid:!1,hide:!1,width:300,valueGetter:null,cellRenderer:"dateRender",pinned:!1}}).constant("OpportunityFields",{name:{label:"Name",field:"name",type:"string",locked:!0,excludeGrid:!1,hide:!1,width:300,valueGetter:null,cellRenderer:null,pinned:!0,"class":"col-xs-12",exludeForm:!1,filterApplied:!1,filterValue:null},primaryCompany:{label:"Primary Company",field:"primaryCompany",type:"lookup",locked:!0,queryKey:"primaryCompany",excludeGrid:!1,hide:!1,width:200,valueGetter:"getPrimaryCompany",cellRenderer:"primaryCompanyRender",pinned:null,"class":"col-xs-12",exludeForm:!1,filterApplied:!1,filterValue:null},pipeline:{label:"Pipeline",field:"pipeline",type:"category",locked:!0,queryKey:"oppPipeline",values:[{label:"Pipeline 1",value:"pipeline1"},{label:"Pipeline 2",value:"pipeline2"}],excludeGrid:!1,hide:!1,width:200,valueGetter:"getNestedValue",cellRenderer:null,pinned:null,"class":"col-xs-12",exludeForm:!0,filterApplied:"includes",filterValue:null,excludeBulk:!0},owners:{label:"Owners",field:"owners",type:"lookup",locked:!0,queryKey:"oppOwner",excludeGrid:!1,hide:!1,width:200,valueGetter:"getNestedOwner",cellRenderer:null,pinned:null,"class":"col-xs-12",exludeForm:!1,filterApplied:"includes",filterValue:null,excludeBulk:!0},value:{label:"Value",field:"value",type:"currency",locked:!0,excludeGrid:!1,hide:!1,width:200,valueGetter:null,cellClass:"text-right",headerValueGetter:"getOppValueHeader",cellRenderer:"oppValueRender",pinned:null,"class":"col-xs-12",exludeForm:!1,filterApplied:!1,filterValue:null},estimatedClose:{label:"Estimated Close",field:"estimatedClose",type:"date",locked:!0,excludeGrid:!1,hide:!1,width:200,valueGetter:null,cellRenderer:"dateWithQuarterRender",pinned:null,"class":"col-xs-6",exludeForm:!1,filterApplied:!1,filterValue:null},actualClose:{label:"Actual Close",field:"actualClose",type:"date",locked:!0,excludeGrid:!1,hide:!1,width:200,valueGetter:null,cellRenderer:"dateWithQuarterRender",pinned:null,"class":"col-xs-6",exludeForm:!1,filterApplied:!1,filterValue:null},forecast:{label:"Forecast",field:"forecast",type:"category",locked:!0,queryKey:"oppForecast",values:[{label:"Pipeline",value:"pipeline"},{label:"Stars Align",value:"starsAlign"},{label:"Likely",value:"likely"},{label:"Hard Commit",value:"hardCommit"}],excludeGrid:!1,hide:!1,width:200,valueGetter:"getNestedValue",cellRenderer:null,pinned:null,"class":"col-xs-12",exludeForm:!1,filterApplied:"includes",filterValue:null},stage:{label:"Stage",colId:"stage.score",field:"stage",type:"category",locked:!0,queryKey:"oppStage",values:[{label:"Stage 1",value:"stage1",percentage:10},{label:"Stage 2",value:"stage2",percentage:50},{label:"Stage 3",value:"stage3",percentage:70},{label:"Stage 4",value:"stage4",percentage:90}],excludeGrid:!1,hide:!1,width:200,valueGetter:"getNestedStage",cellRenderer:"oppStageRender",pinned:null,"class":"col-xs-6",exludeForm:!1,filterApplied:"includes",filterValue:null},status:{label:"Status",colId:"status.order",field:"status",type:"category",locked:!0,queryKey:"oppStatus",values:[{color:"#199ED9",label:"Open",value:"open"},{color:"#F2AF01",label:"Parked",value:"parked"},{color:"#18C489",label:"Closed - Won",value:"closedWon"},{color:"#E85252",label:"Closed - Lost",value:"closedLost"}],excludeGrid:!1,hide:!1,width:200,valueGetter:"getNestedValue",cellRenderer:"oppStatusRender",pinned:null,"class":"col-xs-6",exludeForm:!1,filterApplied:"includes",filterValue:null}}).constant("ContactFields",{fullName:{label:"Name",field:"fullName",type:"string",locked:!0,excludeGrid:!1,hide:!1,width:250,valueGetter:null,cellRenderer:"contactNameRender",pinned:"left"},firstName:{label:"First Name",field:"firstName",type:"string",locked:!0,excludeGrid:!0,hide:!1,width:200,valueGetter:null,cellRenderer:null,pinned:null},lastName:{label:"Last Name",field:"lastName",type:"string",locked:!0,excludeGrid:!0,hide:!1,width:200,valueGetter:null,cellRenderer:null,pinned:null},title:{label:"Title",field:"title",type:"string",locked:!0,excludeGrid:!1,hide:!1,width:200,valueGetter:null,cellRenderer:null,pinned:null},primaryCompany:{label:"Primary Company",field:"primaryCompany",type:"lookup",locked:!0,queryKey:"primaryCompany",excludeGrid:!1,hide:!1,width:200,valueGetter:"getPrimaryCompany",cellRenderer:"primaryCompanyRender",pinned:null},type:{label:"Type",field:"type",type:"category",excludeGrid:!1,hide:!1,width:200,valueGetter:"getNestedValue",cellRenderer:null,pinned:null},emailAddresses:{label:"Email Addresses",field:"emailAddresses",type:"array",excludeGrid:!1,hide:!1,width:200,valueGetter:null,cellRenderer:null,pinned:null},phoneNumbers:{label:"Phone Numbers",field:"phoneNumbers",type:"array",excludeGrid:!1,hide:!1,width:200,valueGetter:null,cellRenderer:null,pinned:null},socialAccounts:{label:"Social Accounts",field:"socialAccounts",type:"array",excludeGrid:!1,hide:!1,width:200,valueGetter:null,cellRenderer:null,pinned:null}}).constant("CompanyFields",{name:{label:"Name",field:"name",type:"string",locked:!0,excludeGrid:!1,hide:!1,width:300,valueGetter:null,cellRenderer:"companyNameRender",pinned:"left"},url:{label:"Website",field:"website",type:"string",locked:!0,excludeGrid:!1,hide:!1,width:200,valueGetter:null,cellRenderer:"websiteRender",pinned:null},type:{label:"Type",field:"type",type:"category",excludeGrid:!1,hide:!1,width:200,valueGetter:"getNestedValue",cellRenderer:null,pinned:null}}).constant("EndFields",{tags:{label:"Tags",field:"tags",type:"lookup",excludeGrid:!1,hide:!1,width:150,valueGetter:null,cellRenderer:"tagsRender",pinned:!1,excludeBulk:!0},lastInteraction:{label:"Last Interaction",field:"lastInteraction",type:"date",excludeGrid:!1,hide:!1,width:150,valueGetter:"getLastInteraction",cellRenderer:"dateRender",pinned:!1,excludeBulk:!0},lastUpdated:{label:"Last Updated",field:"updatedOn",type:"date",excludeGrid:!1,hide:!1,width:150,valueGetter:null,cellRenderer:"dateRender",pinned:!1,excludeBulk:!0},updatedBy:{label:"Updated By",field:"updatedBy",type:"lookup",excludeGrid:!1,hide:!1,width:150,valueGetter:"getNestedOwner",cellRenderer:null,pinned:!1,excludeBulk:!0},createdDate:{label:"Create On",field:"createdOn",type:"date",excludeGrid:!1,hide:!1,width:150,valueGetter:null,cellRenderer:"dateRender",pinned:!1,excludeBulk:!0},createdBy:{label:"Created By",field:"createdBy",type:"lookup",excludeGrid:!1,hide:!1,width:150,valueGetter:"getNestedOwner",cellRenderer:null,pinned:!1,excludeBulk:!0}}),angular.module("interloop.value.permissions",[]).value("Permissions",[{name:"Assign Tasks",description:"The ability to assign tasks to others",key:"ASSIGN_TASKS",enabled:!0},{name:"Bulk Delete",description:"The ability to mass delete (Soft Delete) records",key:"BULK_DELETE",enabled:!0},{name:"Bulk Merge",description:"The ability to merge multiple records at once",key:"BULK_MERGE",enabled:!0},{name:"Export To Excel",description:"The ability to export records to excel (can only export records that users have access to)",key:"EXPORT_GRID",enabled:!0},{name:"Group By",description:"The ability to group records in by various fields",key:"GROUP_BY",enabled:!0},{name:"Filter By Owner",description:"The ability filter records by owner",key:"OWNER_FILTER",enabled:!0},{name:"Save Team Views",description:"The ability to create and share views with a team",key:"SAVE_TEAM_VIEWS",enabled:!0},{name:"Show Opportunity Changes",description:"The ability to overlay any changes on top of the Opportunity list",key:"SHOW_CHANGES_TAB",enabled:!0},{name:"Show Soft Deleted Records",description:"The ability to include and filter by soft deleted records in lists",key:"SHOW_DELETED",enabled:!0},{name:"View Dashboard",description:"The ability to view the dasboards module",key:"VIEW_DASHBOARDS",enabled:!0},{name:"View Billing",description:"The ability to view billing / subscription information (Enabled for App Owner by default)",key:"VIEW_BILLING",enabled:!0},{name:"View Settings",description:"The ability to view settings and make configuration changes (Enabled for admins by default)",key:"VIEW_SETTINGS",enabled:!0}]),angular.module("interloop.value.modalDefs",[]).value("modalDefs",{inviteUsers:{templateUrl:"shared/modals/inviteUsers/inviteUsers.tpl.html",controller:"inviteUsersCtrl",size:"lg",ariaLabelledBy:"Invite Users",ariaDescribedBy:"Invite Users"},newActivity:{templateUrl:"shared/modals/newActivity/newActivity.tpl.html",controller:"newActivityCtrl",size:"md",ariaLabelledBy:"New Activity",ariaDescribedBy:"Create a new activity"},newNote:{templateUrl:"shared/modals/newNote/newNote.tpl.html",controller:"newNoteCtrl",size:"md",ariaLabelledBy:"New Note",ariaDescribedBy:"Create a new note"},newOpportunity:{templateUrl:"shared/modals/newOpportunity/newOpportunity.tpl.html",controller:"newOpportunityCtrl",size:"md",ariaLabelledBy:"New Opportunity",ariaDescribedBy:"Create a new opportunity"},newContact:{templateUrl:"shared/modals/newContact/newContact.tpl.html",controller:"newContactCtrl",size:"md",ariaLabelledBy:"New Contact",ariaDescribedBy:"Create a new contact"},newCompany:{templateUrl:"shared/modals/newCompany/newCompany.tpl.html",controller:"newCompanyCtrl",size:"md",ariaLabelledBy:"New Company",ariaDescribedBy:"Create a new company"},wonReason:{templateUrl:"shared/modals/wonResaon/wonResaon.tpl.html",controller:"wonResaonCtrl",size:"md",ariaLabelledBy:"Won Reason",ariaDescribedBy:"Supply a won reason"},lostReason:{templateUrl:"shared/modals/lostReason/lostReason.tpl.html",controller:"lostReasonCtrl",size:"md",ariaLabelledBy:"Lost Reason",ariaDescribedBy:"Supply a lost reason"},createView:{templateUrl:"shared/modals/createView/createView.tpl.html",controller:"createViewCtrl",size:"md",ariaLabelledBy:"Create View",ariaDescribedBy:"Create a new view"},editView:{templateUrl:"shared/modals/editView/editView.tpl.html",controller:"editViewCtrl",size:"md",ariaLabelledBy:"Edit View",ariaDescribedBy:"Edit an existing view"},deleteView:{templateUrl:"shared/modals/deleteView/deleteView.tpl.html",controller:"deleteViewCtrl",size:"md",ariaLabelledBy:"Delete View",ariaDescribedBy:"Delete an existing view"},bulkAssign:{templateUrl:"shared/modals/bulkAssign/bulkAssign.tpl.html",controller:"bulkAssignCtrl",size:"md",ariaLabelledBy:"Bulk Assign",ariaDescribedBy:"Bulk Assign Records"},bulkDelete:{templateUrl:"shared/modals/bulkDelete/bulkDelete.tpl.html",controller:"bulkDeleteCtrl",size:"md",ariaLabelledBy:"Bulk Delete",ariaDescribedBy:"Bulk Delete Records"},bulkEdit:{templateUrl:"shared/modals/bulkEdit/bulkEdit.tpl.html",controller:"bulkEditCtrl",size:"md",ariaLabelledBy:"Bulk Edit",ariaDescribedBy:"Bulk Edit Records"},bulkTag:{templateUrl:"shared/modals/bulkTag/bulkTag.tpl.html",controller:"bulkTagCtrl",size:"md",ariaLabelledBy:"Add Tags",ariaDescribedBy:"Add Tags"},exportData:{templateUrl:"shared/modals/exportData/exportData.tpl.html",controller:"exportDataCtrl",size:"md",ariaLabelledBy:"Export Data",ariaDescribedBy:"Export Records"},fileUpload:{templateUrl:"shared/modals/fileUpload/fileUpload.tpl.html",controller:"fileUploadCtrl",size:"md",ariaLabelledBy:"Upload File",ariaDescribedBy:"Upload a File"},manageTags:{templateUrl:"shared/modals/manageTags/manageTags.tpl.html",controller:"manageTagsCtrl",size:"md",ariaLabelledBy:"Manage Tags",ariaDescribedBy:"Manage Tags"},invoiceDetails:{templateUrl:"shared/modals/invoiceDetails/invoiceDetails.tpl.html",controller:null,size:"md",ariaLabelledBy:"Invoice Preferences",ariaDescribedBy:"Invoice Preferences"},confirm:{templateUrl:"shared/modals/confirm/confirm.tpl.html",controller:"confirmCtrl",size:"sm",ariaLabelledBy:"Confirm Action",ariaDescribedBy:"Confirm Action"}}),angular.module("interloop.config",["http-interceptor.config","toastr.config","shortcuts.config"]).value("BASE",{URL:window.localStorage.baseUrl||"http://localhost:3000"}).config(["stripeProvider",function(stripeProvider){}]).config(["$intercomProvider",function($intercomProvider){$intercomProvider.appID("vp6k9wou"),$intercomProvider.asyncLoading(!0)}]).config(["$locationProvider",function($locationProvider){"undefined"!=typeof process&&process.versions.electron?$locationProvider.html5Mode(!1):$locationProvider.html5Mode({enabled:!0,requireBase:!1})}]).run(["$rootScope","$location","$state","$timeout","$window","authService","SidebarRouter","ContactFields",function($rootScope,$location,$state,$timeout,$window,authService,SidebarRouter,ContactFields){"undefined"!=typeof process&&process.versions.electron?$rootScope.ELECTRON=!0:$rootScope.ELECTRON=!1,console.log($rootScope.ELECTRON),$window.client=new Pusher("9730e70eeebf029780f6"),$rootScope.connectionSpeed=0,$rootScope.contactFields=ContactFields,$rootScope.options={singleDatePicker:!0,parentEl:"body",applyClass:"btn-primary",drops:"up",locale:{applyLabel:"Apply",fromLabel:"Start",toLabel:"End",format:"MMM D, YYYY",cancelLabel:"Cancel",customRangeLabel:"Custom range"},alwaysShowCalendars:!0,ranges:{"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()]}},$rootScope.options2={singleDatePicker:!1,parentEl:"body",applyClass:"btn-primary",drops:"up",locale:{applyLabel:"Apply",fromLabel:"Start",toLabel:"End",format:"MMM D, YYYY",cancelLabel:"Cancel",customRangeLabel:"Custom range"},alwaysShowCalendars:!0,ranges:{"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()]}},$rootScope.options3={singleDatePicker:!1,parentEl:"body",applyClass:"btn-primary",drops:"down",opens:"left",locale:{applyLabel:"Apply",fromLabel:"Start",toLabel:"End",format:"MMM D, YYYY",cancelLabel:"Cancel"},alwaysShowCalendars:!0},$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){$window.loading_screen.loaded&&$window.loading_screen.finishing||($timeout(function(){$window.loading_screen.finish()},50),toState.data&&toState.data.sidebarState&&(console.log(toState),$rootScope.stateIsLoading=!0),$rootScope.stateLoading=!0,toState.authenticate&&!Appuser.isAuthenticated()&&(event.preventDefault(),$state.go("login")),authService.userHasPermissionForView(toState)||(event.preventDefault(),$state.go("login")))}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){toState.data&&toState.data.sidebarState&&($rootScope.stateIsLoading=!1,SidebarRouter.pushHistory(toState)),$rootScope.stateLoading=!1,toState.data&&toState.data.navTitle&&!toState.sidebarState&&($rootScope.navTitle=toState.data.navTitle),$rootScope.navOpen=!1}),$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){toState.data&&toState.data.sidebarState&&($rootScope.stateIsLoading=!1),$rootScope.stateLoading=!1,console.log("state change error",error)}),$rootScope.$on("loginRequired",function(){$state.go("login")})}]),angular.module("shortcuts.config",[]).run(["$rootScope","$log","hotkeys","modalManager",function($rootScope,$log,hotkeys,modalManager){hotkeys.add({combo:"mod+shift+g",description:"Global Search",callback:function(event){event.preventDefault(),angular.element("#GlobalSearch").focus()}}),hotkeys.add({combo:"mod+shift+l",description:"Local Search",callback:function(event){event.preventDefault(),angular.element("#LocalSearch").focus()}}),hotkeys.add({combo:"mod+shift+a",description:"Create A New Activity",callback:function(event){event.preventDefault(),modalManager.openModal("newActivity"),$log.log("SHORTCUT: New Activity")}}),hotkeys.add({combo:"mod+shift+o",description:"Create A New Opportunity",callback:function(event){event.preventDefault(),modalManager.openModal("newOpportunity"),$log.log("SHORTCUT: New Opportunity")}}),hotkeys.add({combo:"mod+shift+c",description:"Create New Contact",callback:function(event){event.preventDefault(),modalManager.openModal("newContact"),$log.log("SHORTCUT: New Contact")}}),hotkeys.add({combo:"mod+shift+m",description:"Create A New Company",callback:function(event){event.preventDefault(),modalManager.openModal("newCompany"),$log.log("SHORTCUT: New Company")}})}]),angular.module("toastr.config",[]).config(["toastrConfig",function(toastrConfig){angular.extend(toastrConfig,{autoDismiss:!1,containerId:"toast-container",maxOpened:0,newestOnTop:!0,positionClass:"toast-bottom-left",preventDuplicates:!1,preventOpenDuplicates:!1,target:"body"})}]).config(["toastrConfig",function(toastrConfig){angular.extend(toastrConfig,{allowHtml:!1,closeButton:!1,closeHtml:'<button class="btn btn-clear"><icon class="wb-close-mini"></icon></button>',extendedTimeOut:2e3,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},messageClass:"toast-message",onHidden:null,onShown:null,onTap:null,progressBar:!1,tapToDismiss:!0,templates:{toast:"directives/toast/toast.html",progressbar:"directives/progressbar/progressbar.html"},timeOut:3e3,titleClass:"toast-title",toastClass:"toast animated"})}]),angular.module("http-interceptor.config",[]).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$rootScope","$q","$location","LoopBackAuth",function($rootScope,$q,$location,LoopBackAuth){return{responseError:function(rejection){return 401!=rejection.status&&404!=rejection.status||(console.log("401 error handled"),LoopBackAuth.clearUser(),LoopBackAuth.clearStorage(),$location.nextAfterLogin=$location.path(),$rootScope.$emit("loginRequired")),$q.reject(rejection)}}}]),$httpProvider.interceptors.push(["$q","$rootScope","BASE",function($q,$rootScope,BASE){return{request:function(config){if(config.url.includes("/api/")){var windowBase=config.url.substring(0,config.url.indexOf("/api")),configUrlString=config.url.replace(windowBase,BASE.URL);config.url=configUrlString}return config}}}])}]),angular.module("interloop.routes",["interloop.routes.pulse","interloop.routes.sidebarOpportunity","interloop.routes.sidebarContact","interloop.routes.sidebarCompany","interloop.routes.sidebarMore","interloop.routes.settings","interloop.routes.configure"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("app.main.test",{url:"/test",views:{"content@app":{templateUrl:"modules/test/test2.tpl.html",controller:"testCtrl"}},params:{viewId:"default"},data:{pageTitle:"Test",navTitle:"Test"}}),$stateProvider.state("login",{url:"/login",templateUrl:"modules/login/login.tpl.html",controller:"loginCtrl",data:{pageTitle:"Login"},authenticate:!1}),$stateProvider.state("forgot",{url:"/forgot",templateUrl:"modules/forgot/forgot.tpl.html",controller:"forgotCtrl",data:{pageTitle:"Forgot Password | Interloop"},authenticate:!1}),$stateProvider.state("reset",{url:"/reset",templateUrl:"modules/reset/reset.tpl.html",controller:"resetCtrl",data:{pageTitle:"Password Reset | Interloop"},authenticate:!1}),$stateProvider.state("confirmed",{url:"/confirmed",templateUrl:"modules/confirmed/confirmed.tpl.html",data:{pageTitle:"Email Confirmed | Interloop"},authenticate:!1}),$stateProvider.state("signup",{url:"/signup",templateUrl:"modules/signup/signup.tpl.html",data:{pageTitle:"Sign up for a new account | Interloop"},authenticate:!1}),$stateProvider.state("app",{"abstract":!0,templateUrl:"modules/_layout/layout.tpl.html",resolve:{CONFIG:["configService",function(configService){return configService.init()}]}}),$stateProvider.state("app.main",{url:"","abstract":!0,sticky:!0,views:{"nav@app":{templateUrl:"modules/_layout/nav/nav.tpl.html",controller:"navCtrl"}}}),$stateProvider.state("app.sidebar",{"abstract":!0,sticky:!0}),$stateProvider.state("app.main.forecasting",{url:"/forecasting",views:{"content@app":{templateUrl:"modules/forecasting/forecasting.tpl.html",controller:"forecastingCtrl"}},data:{pageTitle:"Forecasting",navTitle:"Forecasting"}}),$stateProvider.state("app.main.opportunities",{url:"/opportunities/view/:viewId",views:{"content@app":{templateUrl:"modules/opportunities/opportunities.tpl.html",controller:"opportunitiesCtrl"}},params:{viewId:"default"},data:{pageTitle:"Opportunities",navTitle:"Opportunities"}}),$stateProvider.state("app.main.contacts",{url:"/contacts/view/:viewId",views:{"content@app":{templateUrl:"modules/contacts/contacts.tpl.html",controller:"contactsCtrl"}},params:{viewId:"default"},data:{pageTitle:"Contacts",navTitle:"Contacts"}}),$stateProvider.state("app.main.companies",{url:"/companies/view/:viewId",views:{"content@app":{templateUrl:"modules/companies/companies.tpl.html",controller:"companiesCtrl"}},params:{viewId:"default"},data:{pageTitle:"Companies",navTitle:"Companies"}}),$stateProvider.state("app.main.activities",{url:"/activities",views:{"content@app":{templateUrl:"modules/activities/activities.tpl.html",controller:"activitiesCtrl"}},data:{pageTitle:"Activities",navTitle:"Activities"}}),$stateProvider.state("app.main.analytics",{url:"/analytics/report/:reportId",views:{"content@app":{templateUrl:"modules/analytics/analytics.tpl.html",controller:"analyticsCtrl"}},params:{reportId:null},data:{pageTitle:"Analytics",navTitle:"Analytics"}}),$stateProvider.state("app.main.search",{url:"/search?q",views:{"content@app":{templateUrl:"modules/search/search.tpl.html"}},data:{pageTitle:"Search Results",navTitle:"Search Results"}}),$stateProvider.state("app.main.notifications",{url:"/notifications",views:{"content@app":{templateUrl:"modules/notifications/notifications2.tpl.html",controller:"notificationsCtrl"}},data:{pageTitle:"My Notifications",navTitle:"My Notifications"}}),$stateProvider.state("otherwise",{url:"*path",template:"",controller:["$state",function($state){$state.go("app.main.contacts")}]})}]),angular.module("interloop.routes.pulse",[]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("app.main.pulse",{url:"/pulse","abstract":!0,views:{"content@app":{templateUrl:"modules/pulse/pulse.tpl.html"}},data:{pageTitle:"Pulse",navTitle:"Pulse"}}),$stateProvider.state("app.main.pulse.outlook",{url:"/outlook",views:{"pulse@app.main.pulse":{templateUrl:"modules/pulse/outlook/outlook.tpl.html"}}}),$stateProvider.state("app.main.pulse.network",{url:"/network",views:{"pulse@app.main.pulse":{templateUrl:"modules/pulse/network/network.tpl.html"}}}),$stateProvider.state("app.main.pulse.article",{url:"/article",views:{"pulse@app.main.pulse":{templateUrl:"modules/pulse/article/article.tpl.html"}},data:{pageTitle:"Article",navTitle:"Article"}}),$stateProvider.state("app.main.pulse.agenda",{url:"/agenda",views:{"pulse@app.main.pulse":{templateUrl:"modules/pulse/agenda/agenda.tpl.html"}}}),$stateProvider.state("app.main.pulse.review",{url:"/review",views:{"pulse@app.main.pulse":{templateUrl:"modules/pulse/review/review.tpl.html"}}}),$stateProvider.state("app.main.pulse.insights",{url:"/insights",views:{"pulse@app.main.pulse":{templateUrl:"modules/pulse/insights/insights.tpl.html"}}})}]),angular.module("interloop.routes.sidebarOpportunity",[]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("app.sidebar.opportunity",{"abstract":!0,views:{"sidebar@app":{templateUrl:"modules/_sidebar/opportunity/opportunity.tpl.html",controller:"sidebarOpportunityCtrl"}},params:{id:null},data:{sidebarState:!0}}),$stateProvider.state("app.sidebar.opportunity.insights",{views:{"sidebar-content@app.sidebar.opportunity":{templateUrl:"modules/_sidebar/opportunity/insights.tpl.html"}}}),$stateProvider.state("app.sidebar.opportunity.details",{views:{"sidebar-content@app.sidebar.opportunity":{templateUrl:"modules/_sidebar/opportunity/details.tpl.html"}}}),$stateProvider.state("app.sidebar.opportunity.related",{views:{"sidebar-content@app.sidebar.opportunity":{templateUrl:"modules/_sidebar/opportunity/related.tpl.html"}}}),$stateProvider.state("app.sidebar.opportunity.activities",{views:{"sidebar-content@app.sidebar.opportunity":{templateUrl:"modules/_sidebar/opportunity/activities.tpl.html"}}})}]),angular.module("interloop.routes.sidebarContact",[]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("app.sidebar.contact",{"abstract":!0,resolve:{demo:["$q","$timeout",function($q,$timeout){var deferred=$q.defer();return $timeout(function(){deferred.resolve("Hello!")},500),deferred.promise}]},views:{"sidebar@app":{templateUrl:"modules/_sidebar/contact/contact.tpl.html"}},data:{sidebarState:!0}}),$stateProvider.state("app.sidebar.contact.insights",{views:{"content@app.sidebar.contact":{templateUrl:"modules/_sidebar/contact/insights.tpl.html"}}}),$stateProvider.state("app.sidebar.contact.details",{views:{"content@app.sidebar.contact":{templateUrl:"modules/_sidebar/contact/details.tpl.html"}}})}]),angular.module("interloop.routes.sidebarCompany",[]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("app.sidebar.company",{"abstract":!0,resolve:{demo:["$q","$timeout",function($q,$timeout){var deferred=$q.defer();return $timeout(function(){deferred.resolve("Hello!")},500),deferred.promise}]},views:{"sidebar@app":{templateUrl:"modules/_sidebar/company/company.tpl.html"}},data:{sidebarState:!0}}),$stateProvider.state("app.sidebar.company.insights",{views:{"content@app.sidebar.company":{templateUrl:"modules/_sidebar/company/insights.tpl.html"}}}),$stateProvider.state("app.sidebar.company.details",{views:{"content@app.sidebar.company":{templateUrl:"modules/_sidebar/company/details.tpl.html"}}})}]),angular.module("interloop.routes.sidebarMore",[]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("app.sidebar.mentions",{views:{"sidebar@app":{templateUrl:"modules/_sidebar/more/mentions/mentions.tpl.html"}},data:{sidebarState:!0}}),$stateProvider.state("app.sidebar.starred",{views:{"sidebar@app":{templateUrl:"modules/_sidebar/more/starred/starred.tpl.html"}},data:{sidebarState:!0}}),$stateProvider.state("app.sidebar.directory",{views:{"sidebar@app":{templateUrl:"modules/_sidebar/more/directory/directory.tpl.html",controller:"directoryCtrl"}},data:{sidebarState:!0}}),$stateProvider.state("app.sidebar.user",{views:{"sidebar@app":{templateUrl:"modules/_sidebar/more/user/user.tpl.html",controller:"userCtrl"}},params:{id:null},data:{sidebarState:!0}}),$stateProvider.state("app.sidebar.my-files",{views:{"sidebar@app":{templateUrl:"modules/_sidebar/more/my-files/my-files.tpl.html"}},data:{sidebarState:!0}})}]),angular.module("interloop.routes.settings",[]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("app.main.settings",{
url:"/settings","abstract":!0,views:{"content@app":{templateUrl:"settings/settings.tpl.html"}},data:{pageTitle:"Settings",navTitle:"Settings"}}),$stateProvider.state("app.main.settings.profile",{url:"/profile",views:{"content@app.main.settings":{templateUrl:"settings/profile/profile.tpl.html",controller:"settingsProfileCtrl"}},data:{pageTitle:"My Profile",navTitle:"Settings"}}),$stateProvider.state("app.main.settings.notifications",{url:"/notifications",views:{"content@app.main.settings":{templateUrl:"settings/notifications/notifications.tpl.html",controller:"settingsNotificationsCtrl"}},data:{pageTitle:"Notification Preferences",navTitle:"Settings"}}),$stateProvider.state("app.main.settings.connected",{url:"/connected",views:{"content@app.main.settings":{templateUrl:"settings/connected/connected.tpl.html",controller:"settingsConnectedCtrl"}},data:{pageTitle:"Connected Apps",navTitle:"Settings"}}),$stateProvider.state("app.main.settings.company",{url:"/company",views:{"content@app.main.settings":{templateUrl:"settings/company/company.tpl.html",controller:"settingsCompanyCtrl"}},data:{pageTitle:"Company Settings",navTitle:"Settings"}}),$stateProvider.state("app.main.settings.users",{url:"/users",views:{"content@app.main.settings":{templateUrl:"settings/users/users.tpl.html",controller:"settingsUsersCtrl"}},data:{pageTitle:"Manage Users",navTitle:"Settings"}}),$stateProvider.state("app.main.settings.permissions",{url:"/permissions",views:{"content@app.main.settings":{templateUrl:"settings/permissions/permissions.tpl.html",controller:"settingsPermissionsCtrl"}},data:{pageTitle:"Teams & Visibility",navTitle:"Settings"}}),$stateProvider.state("app.main.settings.teams",{url:"/teams",views:{"content@app.main.settings":{templateUrl:"settings/teams/teams.tpl.html",controller:"settingsTeamsCtrl"}},data:{pageTitle:"Teams & Visibility",navTitle:"Settings"}}),$stateProvider.state("app.main.settings.integrations",{url:"/integrations",views:{"content@app.main.settings":{templateUrl:"settings/integrations/integrations.tpl.html",controller:"settingsIntegrationsCtrl"}},data:{pageTitle:"Integrations",navTitle:"Settings"}}),$stateProvider.state("app.main.settings.general",{url:"/general",views:{"content@app.main.settings":{templateUrl:"settings/general/general.tpl.html"}},data:{pageTitle:"General Configuration",navTitle:"Settings"}}),$stateProvider.state("app.main.settings.pipelines",{url:"/pipelines",views:{"content@app.main.settings":{templateUrl:"settings/pipelines/pipelines.tpl.html"}},data:{pageTitle:"Pipelines",navTitle:"Settings"}}),$stateProvider.state("app.main.settings.forecast-categories",{url:"/forecast-categories",views:{"content@app.main.settings":{templateUrl:"settings/forecast-categories/forecast-categories.tpl.html"}},data:{pageTitle:"Forecast Categories",navTitle:"Settings"}}),$stateProvider.state("app.main.settings.types",{url:"/types",views:{"content@app.main.settings":{templateUrl:"settings/types/types.tpl.html"}},data:{pageTitle:"Entity Types",navTitle:"Settings"}}),$stateProvider.state("app.main.settings.fields",{url:"/fields",views:{"content@app.main.settings":{templateUrl:"settings/fields/fields.tpl.html",controller:"settingsFieldsCtrl"}},data:{pageTitle:"Detail Fields",navTitle:"Settings"}}),$stateProvider.state("app.main.settings.custom-fields",{url:"/custom-fields",views:{"content@app.main.settings":{templateUrl:"settings/custom-fields/custom-fields.tpl.html"}},data:{pageTitle:"Custom Fields",navTitle:"Settings"}}),$stateProvider.state("app.main.settings.views",{url:"/views",views:{"content@app.main.settings":{templateUrl:"settings/views/views.tpl.html",controller:"settingsViewsCtrl"}},data:{pageTitle:"Manage Views",navTitle:"Settings"}}),$stateProvider.state("app.main.settings.tags",{url:"/tags",views:{"content@app.main.settings":{templateUrl:"settings/tags/tags.tpl.html",controller:"settingsTagsCtrl"}},data:{pageTitle:"Manage Tags",navTitle:"Settings"}}),$stateProvider.state("app.main.settings.subscription",{url:"/subscription",views:{"content@app.main.settings":{templateUrl:"settings/subscription/subscription.tpl.html",controller:"settingsSubscriptionCtrl"}},data:{pageTitle:"Subscription",navTitle:"Settings"}}),$stateProvider.state("app.main.settings.invoices",{url:"/invoices",views:{"content@app.main.settings":{templateUrl:"settings/invoices/invoices.tpl.html",controller:"settingsInvoicesCtrl"}},data:{pageTitle:"Invoices",navTitle:"Settings"}})}]),angular.module("interloop.routes.configure",[]).config(["$stateProvider","$urlRouterProvider","$stickyStateProvider",function($stateProvider,$urlRouterProvider,$stickyStateProvider){$stateProvider.state("app.main.configure",{url:"/configure","abstract":!0,views:{"main@app":{templateUrl:"modules/configure/configure.tpl.html"}},data:{pageTitle:"Configure",navTitle:"Configure"},authenticate:!0}),$stateProvider.state("app.main.configure.permissions",{url:"/permissions",views:{"content@app.main.configure":{templateUrl:"modules/configure/permissions/permissions.tpl.html",controller:"configPermissionsCtrl"}}}),$stateProvider.state("app.main.configure.features",{url:"/feature-flags",views:{"content@app.main.configure":{templateUrl:"modules/configure/features/features.tpl.html",controller:"configFeaturesCtrl"}}}),$stateProvider.state("app.main.configure.raw",{url:"/raw",views:{"content@app.main.configure":{templateUrl:"modules/configure/raw/raw.tpl.html",controller:"configRawCtrl"}}})}]),angular.module("interloop.loginCtrl",[]).controller("loginCtrl",["$scope","$rootScope","$state","$timeout","BASE","Logger","Org","authService","Appuser",function($scope,$rootScope,$state,$timeout,BASE,Logger,Org,authService,Appuser){function login(){$scope.data.loginLoading=!0,$scope.data.loginFailed=!1,$rootScope.ELECTRON?BASE.URL=$scope.data.domain:"localhost"==subdomain_name||"0"==subdomain_name?BASE.URL="http://localhost:3000":BASE.URL="https://interloop2-api-"+subdomain_name+".interloop.ai",$timeout(function(){authService.login($scope.data.email,$scope.data.password,$scope.data.rememberMe)},250)}var subdomain_name=window.location.hostname.split(".").length>=3&&window.location.hostname.split(".")[0];$scope.data={},$scope.data.loginFailed=!1,$scope.data.loginLoading=!1,$scope.data.rememberMe=!0,$scope.data.inputType="password",$scope.login=login,$scope.$on("auth_login_success",function(event,args){$scope.data.loginLoading=!1,window.localStorage.baseUrl=BASE.URL}),$scope.$on("auth_login_failed",function(event,args){$scope.data.loginLoading=!1,$scope.data.loginFailed=!0})}]),angular.module("interloop.forgotCtrl",[]).controller("forgotCtrl",["$scope","authService","Logger",function($scope,authService,Logger){function resetPassword(){authService.resetPassword($scope.data.email)}$scope.data={},$scope.data.resetComplete=!1,$scope.resetPassword=resetPassword,$scope.$on("auth_reset_success",function(event,args){$scope.data.resetComplete=!0}),$scope.$on("auth_reset_failed",function(event,args){var error=args.error.message||"User Not Found";Logger.error(error)})}]),angular.module("interloop.resetCtrl",[]).controller("resetCtrl",["$scope","$location","$http","BASE",function($scope,$location,$http,BASE){function activate(){$http({method:"GET",url:RESETURL+"/check?access_token="+encodeURIComponent($scope.data.accessToken),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(response){$scope.data.loading=!1,$scope.data.showForm=!0},function(response){$scope.data.loading=!1,$scope.data.showForm=!1})}function clearForm(){$scope.data.password="",$scope.data.confirmPassword=""}function updatePassword(){$scope.data.loading=!0,$http({method:"POST",url:RESETURL+"/reset-password?access_token="+encodeURIComponent($scope.data.accessToken),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")},data:{password:$scope.data.password,confirmation:$scope.data.passwordConfirm}}).then(function(response){$scope.data.updateSuccess=!0,$scope.data.loading=!1,clearForm()},function(response){$scope.data.updateError=!0,$scope.data.loading=!1,clearForm()})}$scope.data={},$scope.data.password="",$scope.data.updateSuccess=!1,$scope.data.updateError=!1,$scope.data.loading=!0,$scope.data.showForm=!1,$scope.data.accessToken=$location.search().access_token,console.log($scope.data.accessToken);var RESETURL=BASE.URL.replace("/api","");$scope.clearForm=clearForm,$scope.updatePassword=updatePassword,activate()}]),angular.module("interloop.navCtrl",[]).directive("whenScrolled",function(){return function(scope,elm,attr){var raw=elm[0];elm.bind("scroll",function(){raw.scrollTop+raw.offsetHeight>=raw.scrollHeight&&scope.$apply(attr.whenScrolled)})}}).controller("navCtrl",["$scope","$state","$window","$timeout","$rootScope","$intercom","hotkeys","configService","modalManager","searchService","authService","Appuser","Logger",function($scope,$state,$window,$timeout,$rootScope,$intercom,hotkeys,configService,modalManager,searchService,authService,Appuser,Logger){function openTo(state,id,$event){$event&&$event.stopPropagation(),$scope.data.globalSearch="",$state.go(state,{id:id}),$timeout(function(){$rootScope.sidePanelOpen=!0},100)}function search(){$scope.data.searchLoading=!0,searchService.globalSearch($scope.data.globalSearch,!0).then(function(results){console.log(results),$timeout(function(){$scope.data.searchLoading=!1,$scope.data.searchResults=results,$scope.data.resultsCount=_.flattenDeep(_.map(results,"results")).length},250)})["catch"](function(err){console.log("error searching"),console.log(err)})}function searchScore(result){return result.score>=15}function focusResult($event){if(40==$event.keyCode){$event.preventDefault(),$event.stopPropagation();var firstResult=$window.document.getElementById("globalSearchResults").getElementsByTagName("li")[0].getElementsByTagName("a")[0];console.log(firstResult),firstResult&&firstResult.focus()}else 13==$event.keyCode&&$scope.data.globalSearch&&($scope.globalDropdownOpen=!1,$state.go("app.main.search",{q:$scope.data.globalSearch}))}function newActivity(){modalManager.openModal("newActivity")}function newOpportunity(){modalManager.openModal("newOpportunity")}function newContact(){modalManager.openModal("newContact")}function newCompany(){modalManager.openModal("newCompany")}function keyboardShortcuts(){hotkeys.toggleCheatSheet()}function contactSupport(){console.log("show intercom"),$intercom.show("showNewMessage")}function logout(){authService.logout()}$scope.data={},$scope.data.globalSearch="",$scope.data.results={},$scope.openTo=openTo,$scope.search=search,$scope.searchScore=searchScore,$scope.focusResult=focusResult,$scope.newActivity=newActivity,$scope.newOpportunity=newOpportunity,$scope.newContact=newContact,$scope.newCompany=newCompany,$scope.keyboardShortcuts=keyboardShortcuts,$scope.contactSupport=contactSupport,$scope.logout=logout,$scope.$on("auth_logout_success",function(event,args){configService.shutDown()}),$scope.$on("auth_logout_failed",function(event,args){Logger.error("Logout Failed","Please try again in a moment")})}]),angular.module("interloop.testCtrl",[]).controller("testCtrl",["$scope","Team","Appuser","Opportunity","Contact",function($scope,Team,Appuser,Opportunity,Contact){$scope.data={},$scope.datePicker={},$scope.datePicker.date={startDate:null,endDate:null},$scope.datePicker.date2={startDate:null,endDate:null},$scope.options2={singleDatePicker:!1,parentEl:"body",applyClass:"btn-primary",drops:"up",locale:{applyLabel:"Apply",fromLabel:"Start",toLabel:"End",format:"MMM D, YYYY",cancelLabel:"Cancel",customRangeLabel:"Custom range"},alwaysShowCalendars:!0,ranges:{"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()]}},$scope.data.people=[{name:"Adam",email:"adam@email.com",age:12,country:"United States"},{name:"Amalie",email:"amalie@email.com",age:12,country:"Argentina"},{name:"Estefanía",email:"estefania@email.com",age:21,country:"Argentina"},{name:"Adrian",email:"adrian@email.com",age:21,country:"Ecuador"},{name:"Wladimir",email:"wladimir@email.com",age:30,country:"Ecuador"},{name:"Samantha",email:"samantha@email.com",age:30,country:"United States"},{name:"Nicole",email:"nicole@email.com",age:43,country:"Colombia"},{name:"Natasha",email:"natasha@email.com",age:54,country:"Ecuador"},{name:"Michael",email:"michael@email.com",age:15,country:"Colombia"},{name:"Nicolás",email:"nicolas@email.com",age:43,country:"Colombia"}];var columnDefs=[{headerName:"Make",field:"make"},{headerName:"Model",field:"model"},{headerName:"Price",field:"price"}],rowData=[{make:"Toyota",model:"Celica",price:35e3},{make:"Ford",model:"Mondeo",price:32e3},{make:"Porsche",model:"Boxter",price:72e3}];$scope.gridOptions={columnDefs:columnDefs,rowData:rowData},$scope.createTeam=function(){Opportunity.create({name:"Test This Opp"}).$promise.then(function(results){var thisOpp=results;Contact.create({firstName:"test",lastName:"last"}).$promise.then(function(results){var thisContact=results;Opportunity.entities.create({id:thisOpp.id},{entityId:thisContact.id,entityType:"Contact",name:thisContact.firstName+" "+thisContact.lastName}).$promise.then(function(results){console.log(results)})["catch"](function(err){console.log(err)})})})}}]),angular.module("interloop.homeCtrl",[]).controller("homeCtrl",["$scope",function($scope){function keydown($event){40==$event.keyCode&&($scope.data.emailDropdownOpen=!0)}$scope.data={},$scope.datePicker={},$scope.datePicker.birthday={startDate:null,endDate:null},$scope.data.today=new Date,$scope.options2={singleDatePicker:!0,parentEl:"body",applyClass:"btn-primary",locale:{applyLabel:"Apply",fromLabel:"Start",toLabel:"End",format:"MMM D, YYYY",cancelLabel:"Cancel",customRangeLabel:"Custom range"},alwaysShowCalendars:!0,ranges:{"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()]}},$scope.data.companies=[{name:"Company Name A",url:"companya.com"},{name:"Company Name B",url:"companyb.com"},{name:"Company Name C",url:"companyc.com"},{name:"Company Name D",url:"companyd.com"}],$scope.keydown=keydown}]),angular.module("interloop.componentsCtrl",[]).controller("componentsCtrl",["$scope","$http",function($scope,$http){function loadTags(query){return $http.get("modules/components/tags.json")}$scope.data={},$scope.data.people=[{name:"Adam",email:"adam@email.com",age:12,country:"United States"},{name:"Amalie",email:"amalie@email.com",age:12,country:"Argentina"},{name:"Estefanía",email:"estefania@email.com",age:21,country:"Argentina"},{name:"Adrian",email:"adrian@email.com",age:21,country:"Ecuador"},{name:"Wladimir",email:"wladimir@email.com",age:30,country:"Ecuador"},{name:"Samantha",email:"samantha@email.com",age:30,country:"United States"},{name:"Nicole",email:"nicole@email.com",age:43,country:"Colombia"},{name:"Natasha",email:"natasha@email.com",age:54,country:"Ecuador"},{name:"Michael",email:"michael@email.com",age:15,country:"Colombia"},{name:"Nicolás",email:"nicolas@email.com",age:43,country:"Colombia"}],$scope.tags=[{text:"just"},{text:"some"},{text:"cool"},{text:"tags"}],$scope.data.select2Value=null,$scope.options={parentEl:"body",applyClass:"btn-primary",locale:{applyLabel:"Apply",fromLabel:"Start",toLabel:"End",format:"MMM D, YYYY",cancelLabel:"Cancel",customRangeLabel:"Custom range"},alwaysShowCalendars:!0,ranges:{"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()]}},$scope.options2={singleDatePicker:!0,parentEl:"body",applyClass:"btn-primary",locale:{applyLabel:"Apply",fromLabel:"Start",toLabel:"End",format:"MMM D, YYYY",cancelLabel:"Cancel",customRangeLabel:"Custom range"},alwaysShowCalendars:!0,ranges:{"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()]}},$scope.datePicker={},$scope.datePicker.date={startDate:null,endDate:null},$scope.datePicker.date2={startDate:null,endDate:null},$scope.loadTags=loadTags}]),angular.module("interloop.analyticsCtrl",[]).controller("analyticsCtrl",["$scope","$timeout","$sce","$state","$stateParams","Report",function($scope,$timeout,$sce,$state,$stateParams,Report){function activate(){return Report.find().$promise.then(function(results){$scope.data.reports=results,$scope.data.thisReport=_.find($scope.data.reports,["id",$stateParams.reportId]),console.log($scope.data.thisReport),$scope.data.thisReport&&($scope.data.reportUrl=$sce.trustAsResourceUrl($scope.data.thisReport.url+"?show_title=false")),$scope.data.activated=!0})["catch"](function(err){console.log(err)})}function changeReport(report){$state.go("app.main.analytics",{reportId:report.id})}var columnDefs=[{headerName:"Name",field:"name",width:300,hide:!1,pinned:"left",cellClass:"forecast-user"},{headerName:"Quota",field:"quota",width:250,hide:!1},{headerName:"Closed",field:"closed",width:250,hide:!1,cellClass:"forecastCell"},{headerName:"Forecast",field:"forecast",width:250,hide:!1,cellClass:"forecastCell"},{headerName:"Pipeline",field:"pipeline",width:250,hide:!1,cellClass:"forecastCell"},{headerName:"Omitted",field:"omitted",width:250,hide:!1}],gridOptions={columnDefs:columnDefs,rowData:null,enableColResize:!0,enableSorting:!0,enableFilter:!0,headerHeight:40,rowHeight:50,floatingTopRowData:[],floatingBottomRowData:[]};$scope.data={},$scope.data.gridOptions=gridOptions,$scope.data.dateType="this",$scope.data.timeFrame="12M",$scope.customDate={},$scope.customDate.date={startDate:null,endDate:null},$scope.changeReport=changeReport,activate()}]),angular.module("interloop.forecastingCtrl",[]).controller("forecastingCtrl",["$scope","$timeout",function($scope,$timeout){function onFloatingTopCount(headerRowsToFloat){var count=Number(headerRowsToFloat),rows=createData(count,"Top");gridOptions.api.setFloatingTopRowData(rows)}function setData(rowData){gridOptions.api.setRowData(rowData),onFloatingTopCount(1),setTimeout(function(){},0)}function createData(count,prefix){for(var result=[],i=0;i<count;i++)result.push({athlete:prefix+" Athlete "+i,age:prefix+" Age "+i,country:prefix+" Country "+i,year:prefix+" Year "+i,date:prefix+" Date "+i,sport:prefix+" Sport "+i});return result}function currencyRender(params){var value=_.isNumber(params.value)?params.value.toFixed(0):0;return value}function closedRender(params){var quota=params.data.quota||0,value=_.isNumber(params.value)?params.value.toFixed(0):0,percentage=0==params.data.quota?0:Math.floor(value/quota*100),template='<span class="value">'+value+"</span>";return template+='<div class="progress progress-xs">',template+='<div class="progress-bar" role="progressbar" aria-valuenow="'+percentage+'" aria-valuemin="0" aria-valuemax="100" style="width: '+percentage+'%;"><span class="sr-only">'+percentage+"% Complete</span></div>",template+="</div>",template+='<span class="percent-value">'+percentage+"%</span>"}function activate(){$timeout(function(){setData(createData(5,"test"))},1e3)}var columnDefs=[{headerName:"Name",field:"name",width:300,hide:!1,pinned:"left",cellClass:"forecast-user"},{headerName:"Quota",field:"quota",cellRenderer:currencyRender,width:200,hide:!1},{headerName:"Closed",field:"closed",cellRenderer:closedRender,width:200,hide:!1,cellClass:"forecastCell"},{headerName:"Forecast",field:"forecast",cellRenderer:closedRender,width:200,hide:!1,cellClass:"forecastCell"},{headerName:"Pipeline",field:"pipeline",cellRenderer:closedRender,width:200,hide:!1,cellClass:"forecastCell"},{headerName:"Omitted",field:"omitted",cellRenderer:currencyRender,width:200,hide:!1}],gridOptions={columnDefs:columnDefs,rowData:null,enableColResize:!0,enableSorting:!0,enableFilter:!0,headerHeight:40,rowHeight:50,getRowStyle:function(params){if(params.node.floating)return{"font-weight":"bold"}},floatingTopRowData:[],floatingBottomRowData:[]};$scope.data={},$scope.data.gridOptions=gridOptions,$scope.data.activated=!0,activate()}]),angular.module("interloop.opportunitiesCtrl",[]).controller("opportunitiesCtrl",["$scope","$rootScope","$q","$timeout","$state","$stateParams","$location","$window","View","ViewManager","gridManager","Logger","OpportunityFields","EndFields","modalManager","Appuser",function($scope,$rootScope,$q,$timeout,$state,$stateParams,$location,$window,View,ViewManager,gridManager,Logger,OpportunityFields,EndFields,modalManager,Appuser){function activate(){return View.list({filter:{where:{entity:"Opportunity"}}}).$promise.then(function(results){return $scope.data.views=results,ViewManager.getThisView("Opportunity",$scope.data.views,$stateParams.viewId,query).then(function(results){return $scope.data.thisView=results,$scope.data.count=$scope.data.thisView.count,$scope.data.sum=$scope.data.thisView.sum,$scope.data.min=$scope.data.thisView.min,$scope.data.max=$scope.data.thisView.max,$scope.data.avg=$scope.data.thisView.avg,$scope.data.thisView.id==$rootScope.activeUser.defaultViews.Opportunity&&($scope.data["default"]=!0),gridManager.initGrid("Opportunity",$scope.data.thisView).then(function(results){$scope.data.grid=results,$timeout(function(){viewFilters=$scope.data.thisView.filters||{},$scope.data.fields=initialFilters(viewFilters,_.merge(OpportunityFields,EndFields)),$scope.data.groups=_.filter($scope.data.fields,function(o){return"category"==o.type||"lookup"==o.type}),$scope.data.columns=gridManager.getColumns(),$scope.data.columns.splice(0,2),$scope.data.activated=!0},0)})})})["catch"](function(err){console.log(err)})}function saveView(){var viewDetails={name:$scope.data.thisView.name,entity:"Opportunity",query:gridManager.getCurrentQuery(),filters:getFilters(),columnState:gridManager.getColumnState(),sortModel:gridManager.getSortModel()};View.prototype$patchAttributes({id:$scope.data.thisView.id},viewDetails).$promise.then(function(results){Logger.info("Saved View"),$scope.data.filterChanged=!1})["catch"](function(err){Logger.error("Error Saving View")})}function discardChanges(){$scope.data.fields=initialFilters(viewFilters,_.merge(OpportunityFields,EndFields)),$scope.data.filterChanged=!1}function saveViewAs(){var resolvedData={entity:"Opportunity",query:gridManager.getCurrentQuery(),filters:getFilters(),columnState:gridManager.getColumnState(),sortModel:gridManager.getSortModel()},saveViewModal=modalManager.openModal("createView",resolvedData);saveViewModal.result.then(function(results){results.count=$scope.data.count,results.sum=$scope.data.sum,$scope.data.views.push(results)})}function editView(){modalManager.openModal("editView",$scope.data.thisView)}function deleteView(){modalManager.openModal("deleteView",$scope.data.thisView)}function bulkCreateView(){var query={filter:{where:{id:{inq:_.map($scope.data.selectedData.items,"id")}}}},resolvedData={entity:"Opportunity",query:query,filters:null,columnState:gridManager.getColumnState(),sortModel:null},saveViewModal=modalManager.openModal("createView",resolvedData);saveViewModal.result.then(function(results){results.count=$scope.data.count,results.sum=$scope.data.sum,$scope.data.views.push(results)})}function getFilters(){var filters={};return _.forOwn($scope.data.fields,function(value,key){value.filterApplied&&value.filterValue&&(filters[key]={},filters[key].type=value.filterApplied,"number"==value.type||"currency"==value.type?filters[key].value=parseInt(value.filterValue):filters[key].value=value.filterValue)}),filters}function initialFilters(viewFilters,fields){return _.forOwn($scope.data.fields,function(value,key){"category"==value.type?(value.filterApplied="contains",value.filterValue=[],value.filterValue=null):(value.filterApplied=null,value.filterValue=null)}),_.forOwn(viewFilters,function(value,key){fields[key]&&(fields[key].filterApplied=value.type),fields[key]&&(fields[key].filterValue=value.value)}),$timeout(function(){initFilters=!1},500),fields}function changeView(view){$rootScope.filterPanelOpen=!1,$state.go($state.current.name,{viewId:view.id},{reload:"app.main.opportunities"})}function changeLocalSearch(){gridManager.setLocalSearch($scope.data.localSearch)}function refreshView(){gridManager.refreshView()}function sizeToFit(){gridManager.sizeToFit()}function exportData(){modalManager.openModal("exportData")}function importData(){modalManager.openModal("importData")}function clearSelected(){gridManager.clearSelected()}function showHideColumn(column,visible){gridManager.showHideColumn(column,visible)}function toggleOpen(field){field.open=!field.open}function setUnsetDefault(value){1==value?ViewManager.setDefault($scope.data.thisView).then(function(){$scope.data["default"]=!0}):ViewManager.clearDefault($scope.data.thisView).then(function(){$scope.data["default"]=!1})}function bulkAssign(){var resolveData={entity:"Opportunity",selectedItems:$scope.data.selectedData.items};modalManager.openModal("bulkAssign",resolveData)}function bulkEdit(){var resolveData={entity:"Opportunity",selectedItems:$scope.data.selectedData.items};modalManager.openModal("bulkEdit",resolveData)}function bulkTag(){var resolveData={entity:"Opportunity",selectedItems:$scope.data.selectedData.items};modalManager.openModal("bulkTag",resolveData)}function bulkExport(){var resolveData={entity:"Opportunity",selectedItems:$scope.data.selectedData.items};modalManager.openModal("exportData",resolveData)}function createView(){modalManager.openModal("createView")}function bulkDelete(){var resolveData={entity:"Opportunity",selectedItems:$scope.data.selectedData.items},bulkDeleteModal=modalManager.openModal("bulkDelete",resolveData);bulkDeleteModal.result.then(function(results){$scope.data.selectedData.items=[]})}var initializing=!0,initFilters=!0,query=$location.search().query||null,viewFilters={};$scope.data={},$scope.data.activated=!1,$scope.data.drawerOpen=!1,$scope.data.filterView="filters",$scope.data.filterAccordions={},$scope.data.filterChanged=!1,$scope.data.valueType="total",$scope.data.overlay="none",$scope.data.overlayDuration="7",$scope.datePicker={},$scope.datePicker.date={startDate:null,endDate:null},$scope.datePicker.date2={startDate:null,endDate:null},$scope.data.localSearch=gridManager.getLocalSearch(),$scope.data.selectedData=gridManager.getSelectedData(),$scope.refreshView=refreshView,$scope.sizeToFit=sizeToFit,$scope.exportData=exportData,$scope.importData=importData,$scope.clearSelected=clearSelected,$scope.changeLocalSearch=changeLocalSearch,$scope.changeView=changeView,$scope.setUnsetDefault=setUnsetDefault,$scope.bulkAssign=bulkAssign,$scope.bulkEdit=bulkEdit,$scope.bulkExport=bulkExport,$scope.bulkTag=bulkTag,$scope.createView=createView,$scope.bulkDelete=bulkDelete,$scope.discardChanges=discardChanges,$scope.saveView=saveView,$scope.saveViewAs=saveViewAs,$scope.editView=editView,$scope.deleteView=deleteView,$scope.bulkCreateView=bulkCreateView,$scope.initialFilters=initialFilters,$scope.showHideColumn=showHideColumn,$scope.toggleOpen=toggleOpen,activate(),$scope.saveFilters=function(){console.log(getFilters())},$scope.$watch("data.fields",function(newVal,oldVal){initFilters||(_.isEqual(getFilters(),viewFilters)?$scope.data.filterChanged=!1:$scope.data.filterChanged=!0,gridManager.changeCurrentQuery(getFilters()).then(function(results){$scope.data.count=results.count,$scope.data.sum=results.sum,$scope.data.min=results.min,$scope.data.max=results.max,$scope.data.avg=results.avg}))},!0),$scope.$watchCollection("data.overlay",function(newVal,oldVal){initializing?$timeout(function(){initializing=!1}):gridManager.setContext("changeHistory",newVal)}),$scope.$watchCollection("data.overlayDuration",function(newVal,oldVal){initializing?$timeout(function(){initializing=!1}):gridManager.setContext("changeHistoryDuration",newVal)}),$scope.$watchCollection("data.valueType",function(newVal,oldVal){initializing?$timeout(function(){initializing=!1}):gridManager.setContext("valueType",newVal)})}]),angular.module("interloop.companiesCtrl",[]).controller("companiesCtrl",["$scope","$rootScope","$q","$timeout","$stateParams","$location","View","ViewManager","gridManager","CompanyFields","EndFields","modalManager","Appuser",function($scope,$rootScope,$q,$timeout,$stateParams,$location,View,ViewManager,gridManager,CompanyFields,EndFields,modalManager,Appuser){function activate(viewId){var viewId=viewId?viewId:$stateParams.viewId;return View.list({filter:{where:{entity:"Company"}}}).$promise.then(function(results){return $scope.data.views=results,ViewManager.getThisView("Company",$scope.data.views,viewId,query).then(function(results){return $scope.data.thisView=results,$scope.data.thisView.id==$rootScope.activeUser.defaultViews.Company&&($scope.data["default"]=!0),gridManager.initGrid("Company",$scope.data.thisView).then(function(results){$scope.data.grid=results,$timeout(function(){$scope.data.thisView&&$scope.data.thisView.filters?$scope.data.fields=_.values(_.merge(_.merge(CompanyFields,EndFields),$scope.data.thisView.filters)):$scope.data.fields=_.merge(CompanyFields,EndFields),_.forEach(_.filter($scope.data.fields,["type","date"]),function(value,key){value.date={startDate:null,endDate:null}}),$scope.data.groups=_.filter($scope.data.fields,function(o){return"category"==o.type||"lookup"==o.type}),$scope.data.columns=gridManager.getColumns(),$scope.data.columns.splice(0,2),$scope.data.activated=!0},0)})})})["catch"](function(err){console.log(err)})}function changeView(view){$scope.data.thisView=view,gridManager.changeView(view)}function changeLocalSearch(){gridManager.setLocalSearch($scope.data.localSearch)}function refreshView(){gridManager.refreshView()}function sizeToFit(){gridManager.sizeToFit()}function exportData(){modalManager.openModal("exportData")}function clearSelected(){gridManager.clearSelected()}function showHideColumn(column,visible){gridManager.showHideColumn(column,visible)}function toggleOpen(field){field.open=!field.open}function setUnsetDefault(value){1==value?ViewManager.setDefault($scope.data.thisView).then(function(){$scope.data["default"]=!0}):ViewManager.clearDefault($scope.data.thisView).then(function(){$scope.data["default"]=!1})}function bulkAssign(){modalManager.openModal("bulkAssign")}function bulkEdit(){modalManager.openModal("bulkEdit")}function bulkExport(){modalManager.openModal("exportData")}function createView(){modalManager.openModal("createView")}function bulkDelete(){modalManager.openModal("bulkDelete")}var query=$location.search().query||null;$scope.data={},$scope.data.activated=!1,$scope.data.drawerOpen=!1,$scope.data.filterView="filters",$scope.data.valueType="total",$scope.data.overlay="none",$scope.data.overlayDuration="7",$scope.datePicker={},$scope.datePicker.date={startDate:null,endDate:null},$scope.datePicker.date2={startDate:null,endDate:null},$scope.options={singleDatePicker:!0,parentEl:"body",applyClass:"btn-primary",drops:"up",locale:{applyLabel:"Apply",fromLabel:"Start",toLabel:"End",format:"MMM D, YYYY",cancelLabel:"Cancel",customRangeLabel:"Custom range"},alwaysShowCalendars:!0,ranges:{"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()]}},$scope.options2={singleDatePicker:!1,parentEl:"body",applyClass:"btn-primary",drops:"up",locale:{applyLabel:"Apply",fromLabel:"Start",toLabel:"End",format:"MMM D, YYYY",cancelLabel:"Cancel",customRangeLabel:"Custom range"},alwaysShowCalendars:!0,ranges:{"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()]}},$scope.data.localSearch=gridManager.getLocalSearch(),$scope.data.selectedData=gridManager.getSelectedData(),$scope.refreshView=refreshView,$scope.sizeToFit=sizeToFit,$scope.exportData=exportData,$scope.clearSelected=clearSelected,$scope.changeLocalSearch=changeLocalSearch,$scope.changeView=changeView,$scope.setUnsetDefault=setUnsetDefault,$scope.bulkAssign=bulkAssign,$scope.bulkEdit=bulkEdit,$scope.bulkExport=bulkExport,$scope.createView=createView,$scope.bulkDelete=bulkDelete,$scope.showHideColumn=showHideColumn,$scope.toggleOpen=toggleOpen,activate()}]),angular.module("interloop.contactsCtrl",[]).controller("contactsCtrl",["$scope","$rootScope","$q","$timeout","$stateParams","$location","View","ViewManager","gridManager","ContactFields","EndFields","modalManager","Appuser",function($scope,$rootScope,$q,$timeout,$stateParams,$location,View,ViewManager,gridManager,ContactFields,EndFields,modalManager,Appuser){
function activate(viewId){var viewId=viewId?viewId:$stateParams.viewId;return View.list({filter:{where:{entity:"Contact"}}}).$promise.then(function(results){return $scope.data.views=results,ViewManager.getThisView("Contact",$scope.data.views,viewId,query).then(function(results){return $scope.data.thisView=results,$scope.data.thisView.id==$rootScope.activeUser.defaultViews.Contact&&($scope.data["default"]=!0),gridManager.initGrid("Contact",$scope.data.thisView).then(function(results){$scope.data.grid=results,$timeout(function(){$scope.data.thisView&&$scope.data.thisView.filters?$scope.data.fields=_.values(_.merge(_.merge(ContactFields,EndFields),$scope.data.thisView.filters)):$scope.data.fields=_.merge(ContactFields,EndFields),_.forEach(_.filter($scope.data.fields,["type","date"]),function(value,key){value.date={startDate:null,endDate:null}}),$scope.data.groups=_.filter($scope.data.fields,function(o){return"category"==o.type||"lookup"==o.type}),$scope.data.columns=gridManager.getColumns(),$scope.data.columns.splice(0,2),$scope.data.activated=!0},0)})})})["catch"](function(err){console.log(err)})}function changeView(view){$scope.data.thisView=view,gridManager.changeView(view)}function changeLocalSearch(){gridManager.setLocalSearch($scope.data.localSearch)}function refreshView(){gridManager.refreshView()}function sizeToFit(){gridManager.sizeToFit()}function exportData(){modalManager.openModal("exportData")}function clearSelected(){gridManager.clearSelected()}function showHideColumn(column,visible){gridManager.showHideColumn(column,visible)}function toggleOpen(field){field.open=!field.open}function setUnsetDefault(value){1==value?ViewManager.setDefault($scope.data.thisView).then(function(){$scope.data["default"]=!0}):ViewManager.clearDefault($scope.data.thisView).then(function(){$scope.data["default"]=!1})}function bulkAssign(){modalManager.openModal("bulkAssign")}function bulkEdit(){modalManager.openModal("bulkEdit")}function bulkExport(){modalManager.openModal("exportData")}function createView(){modalManager.openModal("createView")}function bulkDelete(){modalManager.openModal("bulkDelete")}var query=$location.search().query||null;$scope.data={},$scope.data.activated=!1,$scope.data.drawerOpen=!1,$scope.data.filterView="filters",$scope.data.valueType="total",$scope.data.overlay="none",$scope.data.overlayDuration="7",$scope.datePicker={},$scope.datePicker.date={startDate:null,endDate:null},$scope.datePicker.date2={startDate:null,endDate:null},$scope.options={singleDatePicker:!0,parentEl:"body",applyClass:"btn-primary",drops:"up",locale:{applyLabel:"Apply",fromLabel:"Start",toLabel:"End",format:"MMM D, YYYY",cancelLabel:"Cancel",customRangeLabel:"Custom range"},alwaysShowCalendars:!0,ranges:{"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()]}},$scope.options2={singleDatePicker:!1,parentEl:"body",applyClass:"btn-primary",drops:"up",locale:{applyLabel:"Apply",fromLabel:"Start",toLabel:"End",format:"MMM D, YYYY",cancelLabel:"Cancel",customRangeLabel:"Custom range"},alwaysShowCalendars:!0,ranges:{"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()]}},$scope.data.localSearch=gridManager.getLocalSearch(),$scope.data.selectedData=gridManager.getSelectedData(),$scope.refreshView=refreshView,$scope.sizeToFit=sizeToFit,$scope.exportData=exportData,$scope.clearSelected=clearSelected,$scope.changeLocalSearch=changeLocalSearch,$scope.changeView=changeView,$scope.setUnsetDefault=setUnsetDefault,$scope.bulkAssign=bulkAssign,$scope.bulkEdit=bulkEdit,$scope.bulkExport=bulkExport,$scope.createView=createView,$scope.bulkDelete=bulkDelete,$scope.showHideColumn=showHideColumn,$scope.toggleOpen=toggleOpen,activate()}]),angular.module("interloop.activitiesCtrl",[]).controller("activitiesCtrl",["$scope","$rootScope","$q","$timeout","$stateParams","$location","View","ViewManager","gridManager","ActivityFields","EndFields","modalManager","Appuser",function($scope,$rootScope,$q,$timeout,$stateParams,$location,View,ViewManager,gridManager,ActivityFields,EndFields,modalManager,Appuser){function activate(viewId){var viewId=viewId?viewId:$stateParams.viewId;return View.list({filter:{where:{entity:"Activity"}}}).$promise.then(function(results){return $scope.data.views=results,ViewManager.getThisView("Activity",$scope.data.views,viewId,query).then(function(results){return $scope.data.thisView=results,$scope.data.thisView.id==$rootScope.activeUser.defaultViews.Activity&&($scope.data["default"]=!0),gridManager.initGrid("Activity",$scope.data.thisView).then(function(results){$scope.data.grid=results,$timeout(function(){$scope.data.thisView&&$scope.data.thisView.filters?$scope.data.fields=_.values(_.merge(_.merge(ActivityFields,EndFields),$scope.data.thisView.filters)):$scope.data.fields=_.merge(ActivityFields,EndFields),_.forEach(_.filter($scope.data.fields,["type","date"]),function(value,key){value.date={startDate:null,endDate:null}}),$scope.data.groups=_.filter($scope.data.fields,function(o){return"category"==o.type||"lookup"==o.type}),$scope.data.columns=gridManager.getColumns(),$scope.data.columns.splice(0,2),$scope.data.activated=!0},0)})})})["catch"](function(err){console.log(err)})}function changeView(view){$scope.data.thisView=view,gridManager.changeView(view)}function changeLocalSearch(){gridManager.setLocalSearch($scope.data.localSearch)}function refreshView(){gridManager.refreshView()}function sizeToFit(){gridManager.sizeToFit()}function exportData(){modalManager.openModal("exportData")}function clearSelected(){gridManager.clearSelected()}function showHideColumn(column,visible){gridManager.showHideColumn(column,visible)}function toggleOpen(field){field.open=!field.open}function setUnsetDefault(value){1==value?ViewManager.setDefault($scope.data.thisView).then(function(){$scope.data["default"]=!0}):ViewManager.clearDefault($scope.data.thisView).then(function(){$scope.data["default"]=!1})}function bulkAssign(){modalManager.openModal("bulkAssign")}function bulkEdit(){modalManager.openModal("bulkEdit")}function bulkExport(){modalManager.openModal("exportData")}function createView(){modalManager.openModal("createView")}function bulkDelete(){modalManager.openModal("bulkDelete")}var query=$location.search().query||null;$scope.data={},$scope.data.activated=!1,$scope.data.drawerOpen=!1,$scope.data.filterView="filters",$scope.data.valueType="total",$scope.data.overlay="none",$scope.data.overlayDuration="7",$scope.datePicker={},$scope.datePicker.date={startDate:null,endDate:null},$scope.datePicker.date2={startDate:null,endDate:null},$scope.options={singleDatePicker:!0,parentEl:"body",applyClass:"btn-primary",drops:"up",locale:{applyLabel:"Apply",fromLabel:"Start",toLabel:"End",format:"MMM D, YYYY",cancelLabel:"Cancel",customRangeLabel:"Custom range"},alwaysShowCalendars:!0,ranges:{"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()]}},$scope.options2={singleDatePicker:!1,parentEl:"body",applyClass:"btn-primary",drops:"up",locale:{applyLabel:"Apply",fromLabel:"Start",toLabel:"End",format:"MMM D, YYYY",cancelLabel:"Cancel",customRangeLabel:"Custom range"},alwaysShowCalendars:!0,ranges:{"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()]}},$scope.data.localSearch=gridManager.getLocalSearch(),$scope.data.selectedData=gridManager.getSelectedData(),$scope.refreshView=refreshView,$scope.sizeToFit=sizeToFit,$scope.exportData=exportData,$scope.clearSelected=clearSelected,$scope.changeLocalSearch=changeLocalSearch,$scope.changeView=changeView,$scope.setUnsetDefault=setUnsetDefault,$scope.bulkAssign=bulkAssign,$scope.bulkEdit=bulkEdit,$scope.bulkExport=bulkExport,$scope.createView=createView,$scope.bulkDelete=bulkDelete,$scope.showHideColumn=showHideColumn,$scope.toggleOpen=toggleOpen,activate()}]),angular.module("interloop.notificationsCtrl",[]).controller("notificationsCtrl",["$scope","$timeout","$rootScope","Logger","Appuser",function($scope,$timeout,$rootScope,Logger,Appuser){function activate(){loadMore()}function loadMore(){if(console.log("load more"),!$scope.data.busy)return $scope.data.busy=!0,Appuser.notifications({id:$rootScope.activeUser.id},{filter:{limit:perPage,skip:currentPage*perPage,order:"createdOn DESC"}}).$promise.then(function(results){$timeout(function(){$scope.data.notifications=$scope.data.notifications.concat(results),currentPage++,$scope.data.busy=!1,$scope.data.loaded=!0},500)})["catch"](function(err){Logger.log("error fetching activities"),$scope.data.loaded=!0})}function toDay(item){return item.day=moment(item.createdOn).format("ll"),item}var currentPage=0,perPage=15;$scope.data={},$scope.data.notifications=[],$scope.data.busy=!1,$scope.data.loaded=!1,$scope.data.today=moment().format("ll"),$scope.data.yesterday=moment().subtract(1,"days").format("ll"),$scope.loadMore=loadMore,$scope.toDay=toDay,activate()}]),angular.module("interloop.sidebarOpportunityCtrl",[]).controller("sidebarOpportunityCtrl",["$scope","$stateParams","Logger","Opportunity","OpportunityFields","SidebarActions",function($scope,$stateParams,Logger,Opportunity,OpportunityFields,SidebarActions){function activate(){return console.log($stateParams.id),Opportunity.findById({id:$stateParams.id}).$promise.then(function(results){$scope.data.thisOpp=results,console.log("thisOpp",$scope.data.thisOpp),$scope.data.activated=!0})["catch"](function(err){Logger.error("Error Retrieving Opportunity"),Logger.log(err),$scope.data.activated=!0})}function isStarred(opportunity){return!0}function cloneItem(){SidebarManager.cloneItem("Opportunity",$scope.data.thisOpp,$scope.data.owners)}function copyShareLink(){SidebarManager.copyShareLink(shareLink)}function deleteItem(){SidebarManager.deleteItem("Opportunity",$scope.data.thisOpp)}function unArchiveItem(){SidebarManager.unArchiveItem("Opportunity",$scope.data.thisOpp)}function starUnstarItem(){$scope.data.thisOpp.starred?unStarItem():starItem()}function starItem(){SidebarManager.starItem("Opportunity",$scope.data.thisOpp)}function unStarItem(){SidebarManager.unStarItem($scope.data.thisOpp)}function triggerUpload(){angular.element("#OpportunityFileUpload").trigger("click")}function uploadFiles(){SidebarManager.uploadFiles("Opportunity",$scope.data.thisOpp,files)}function manageTags(){SidebarManager.manageTags("Opportunity",$scope.data.thisOpp)}function manageRelationships(){SidebarManager.relateToWizard("Opportunity",$scope.data.thisOpp,$scope.data.pickLists)}$scope.data={},$scope.data.activated=!1,$scope.data.fields=OpportunityFields,$scope.isStarred=isStarred,$scope.cloneItem=cloneItem,$scope.copyShareLink=copyShareLink,$scope.deleteItem=deleteItem,$scope.unArchiveItem=unArchiveItem,$scope.starUnstarItem=starUnstarItem,$scope.triggerUpload=triggerUpload,$scope.uploadFiles=uploadFiles,$scope.manageTags=manageTags,$scope.manageRelationships=manageRelationships,$scope.uploadFiles=uploadFiles,activate()}]),angular.module("interloop.directoryCtrl",[]).controller("directoryCtrl",["$scope","Appuser",function($scope,Appuser){function activate(){return Appuser.find({filter:{where:{deactivated:!1}}}).$promise.then(function(results){$scope.data.users=results,$scope.data.activated=!0})["catch"](function(err){Logger.log("Error Fetching Users"),$scope.data.activated=!0})}$scope.data={},$scope.data.activated=!1,activate()}]),angular.module("interloop.userCtrl",[]).controller("userCtrl",["$scope","$stateParams","Appuser",function($scope,$stateParams,Appuser){function activate(){return Appuser.findById({id:$stateParams.id}).$promise.then(function(results){$scope.data.thisUser=results,$scope.data.activated=!0})["catch"](function(err){Logger.log("Error Fetching User Profile"),$scope.data.activated=!0})}$scope.data={},$scope.data.activated=!1,activate()}]),angular.module("interloop.myFilesCtrl",[]).controller("myFilesCtrl",["$scope","$rootScope","Logger","Appuser","Attachment",function($scope,$rootScope,Logger,Appuser,Attachment){function activate(){return Appuser.attachments({id:$rootScope.activeUser.id}).$promise.then(function(results){$scope.data.files=results})["catch"](function(err){Logger.error("Error Retrieving Files","Please try again in a moment")})}$scope.data={},$scope.data.activated=!1,activate()}]),angular.module("interloop.myStarredCtrl",[]).controller("myStarredCtrl",["$scope","Attachment",function($scope,Attachment){function activate(){}$scope.data={},$scope.data.activated=!1,activate()}]),angular.module("interloop.settingsProfileCtrl",[]).controller("settingsProfileCtrl",["$scope","$rootScope","$http","$q","$timeout","$window","Logger","Appuser",function($scope,$rootScope,$http,$q,$timeout,$window,Logger,Appuser){function activate(){return Appuser.findById({id:$rootScope.activeUser.id}).$promise.then(function(result){$scope.data.thisUser=result,$timeout(function(){$scope.data.activated=!0},750)})["catch"](function(err){$timeout(function(){$scope.data.activated=!0,Logger.error("Error retrieving profile information")},750)})}function save(){$scope.data.updateLoading=!0,Appuser.updateAttributes({id:$rootScope.activeUser.id},$scope.data.thisUser).$promise.then(function(response){Logger.info("Successfully Updated Profile"),console.log(response),Logger.log(response),$rootScope.activeUser=response,$scope.data.updateLoading=!1},function(response){Logger.error("Error Updating Profile"),$scope.data.updateLoading=!1})}function updatePassword(){$scope.data.thisUser.password=$scope.data.confirmPassword,Appuser.updateAttributes({id:$rootScope.activeUser.id},{password:$scope.data.confirmPassword}).$promise.then(function(response){Logger.info("Successfully Updated Password"),$rootScope.activeUser=response,$scope.data.updateLoading=!1,clearPasswords()},function(response){Logger.error("Error Updating Password"),$scope.data.updateLoading=!1,clearPasswords()})}function clearPasswords(){$scope.data.newPassword="",$scope.data.confirmPassword=""}function clearCache(){$window.location.reload()}$scope.data={},$scope.data.page=1,$scope.data.activated=!1,$scope.save=save,$scope.updatePassword=updatePassword,$scope.clearCache=clearCache,activate()}]),angular.module("interloop.settingsNotificationsCtrl",[]).controller("settingsNotificationsCtrl",["$scope","$rootScope","$http","$timeout","BASE","Logger","Appuser","webNotification",function($scope,$rootScope,$http,$timeout,BASE,Logger,Appuser,webNotification){function activate(){return $scope.data.activated=!1,Appuser.findById({id:$rootScope.activeUser.id}).$promise.then(function(result){webNotification.permissionGranted||($scope.data.webNotifications=!1),$scope.data.thisUser=result,_.isNil($scope.data.thisUser.alertSettings)&&($scope.data.thisUser.alertSettings={oppAssigned:!0,taskFollowComplete:!0,taskAssigned:!0,taskReminder:!0,commentFollowPosted:!0,commentPosted:!0,commentCreatedItem:!0,commentOwnerItem:!0,dailyPlanner:!0}),$timeout(function(){$scope.data.activated=!0},750)})["catch"](function(error){$timeout(function(){$scope.data.activated=!0,Logger.error("Error retrieving profile information")},750)})}function save(){$scope.data.updateLoading=!0,Appuser.updateAttributes({id:$rootScope.activeUser.id},$scope.data.thisUser).$promise.then(function(response){Logger.info("Successfully Updated Profile"),$rootScope.activeUser=response,$scope.data.updateLoading=!1},function(err){Logger.error("Error Updating Profile"),$scope.data.updateLoading=!1})}function allowWebNotifications(){webNotification.showNotification("Test Notification",{body:"You can now recieve notifications",icon:"assets/img/interloop-icon.ico",onClick:function(){}},function(error,hide){error||setTimeout(function(){hide(),AlertBanner.closeBanner()},4e3)})}$scope.data={},$scope.data.activated=!1,$scope.data.webNotifications=!0,$scope.save=save,$scope.allowWebNotifications=allowWebNotifications,activate()}]),angular.module("interloop.settingsConnectedCtrl",[]).controller("settingsConnectedCtrl",["$scope","$rootScope","$http","$location","BASE","Appuser","Logger",function($scope,$rootScope,$http,$location,BASE,Appuser,Logger){function activate(){return Appuser.findById({id:$rootScope.activeUser.id}).$promise.then(function(results){if($rootScope.activeUser=results,$location.search().redirect){var connectedApp=$location.search().app||"";"success"==$location.search().status?Logger.success("Successfully Connected "+connectedApp):"error"==$location.search().status&&Logger.error("Error Connecting "+connectedApp,"Please try again in a few moments")}$scope.data.activated=!0})["catch"](function(err){console.log("Error finding user"),$scope.data.activated=!0})}function testGraph(){$http({method:"GET",url:"https://graph.microsoft.com/v1.0/me/messages"}).then(function(response){},function(response){})}function getIcloud(){$http({method:"GET",url:CONNECTURL+"/icloud",params:{username:"jordan@berryhome.net",password:"NDswimmer13"}}).then(function(response){console.log(response)},function(response){})}function getNotes(){$http({method:"GET",url:CONNECTURL+"/evernotes",params:{userId:$rootScope.activeUser.id}}).then(function(response){console.log(response.data)},function(response){})}function microsoftConnect(){Logger.log("trying to connect to microsoft..."),adalAuthenticationService.login()}var CONNECTURL=BASE.URL.replace("/api","");$scope.data={},$scope.data.activated=!1,$scope.data.connectCalendarUrl="https://app.cronofy.com/oauth/authorize?response_type=code&client_id=lcfLKt_57ddS6Fcy--JrJPUFXqpI6_-i&redirect_uri=http://localhost:3001/settings/integrations&scope=read_events&avoid_linking=true",$scope.data.evernoteURL=CONNECTURL+"/connect_evernote?userId="+Appuser.getCurrentId(),$scope.data.office365Url=CONNECTURL+"/connect_office365?userId="+Appuser.getCurrentId(),$scope.data.googleUrl=CONNECTURL+"/connect_google?userId="+Appuser.getCurrentId(),$scope.data.dropboxUrl=CONNECTURL+"/connect_dropbox?userId="+Appuser.getCurrentId(),$scope.microsoftConnect=microsoftConnect,$scope.testGraph=testGraph,$scope.getNotes=getNotes,$scope.getIcloud=getIcloud,activate()}]),angular.module("interloop.settingsCompanyCtrl",[]).controller("settingsCompanyCtrl",["$scope","Org","Logger",function($scope,Org,Logger){function activate(){return Org.findOne().$promise.then(function(results){$scope.data.thisOrg=results})}function save(){$scope.data.thisOrg.$save().then(function(){Logger.info("Successfully Updated")})}$scope.data={},$scope.save=save,activate()}]),angular.module("interloop.settingsUsersCtrl",[]).controller("settingsUsersCtrl",["$scope","Appuser","Logger","modalManager",function($scope,Appuser,Logger,modalManager){function activate(){return Appuser.find().$promise.then(function(results){$scope.data.users=results,$scope.data.activated=!0})["catch"](function(err){Logger.error("Error Fetching Users"),$scope.data.activated=!0})}function inviteUsers(){modalManager.openModal("inviteUsers")}function deactivate(user){var deactiveUser=modalManager.openModal("confirm");deactiveUser.result.then(function(){return changeUserState(user,!0)},function(){Logger.log("Cancel")})}function changeUserState(user,boolean){return Appuser.updateAttributes({id:user.id},{deactivated:boolean}).$promise.then(function(response){boolean?(Logger.error("User Deactivated"),user.deactivated=!0):(Logger.success("User Re-Activated"),user.deactivated=!1)},function(response){Logger.error("Error Updating Profile")})}$scope.data={},$scope.data.activated=!1,$scope.data.sortBy={label:"First Name",value:"firstName"},$scope.data.sortOptions=[{label:"First Name",value:"firstName"},{label:"Last Name",value:"lastName"},{label:"Created Date",value:"createdOn"}],$scope.inviteUsers=inviteUsers,$scope.deactivate=deactivate,$scope.changeUserState=changeUserState,activate()}]),angular.module("interloop.settingsPermissionsCtrl",[]).controller("settingsPermissionsCtrl",["$scope","$rootScope","$log","$timeout","$uibModal","Logger","Appuser","Team",function($scope,$rootScope,$log,$timeout,$uibModal,Logger,Appuser,Team){function activate(){}$scope.data={},$scope.data.activated=!0,activate()}]),angular.module("interloop.settingsTeamsCtrl",[]).controller("settingsTeamsCtrl",["$scope","$rootScope","$log","$timeout","$uibModal","Logger","Appuser","Team",function($scope,$rootScope,$log,$timeout,$uibModal,Logger,Appuser,Team){function activate(){return Team.find().$promise.then(function(results){_.forEach(results,function(value,key){value.collapsed=!0}),$scope.data.teams=results,$scope.data.activated=!0})["catch"](function(err){Logger.error("Error Fetching Teams"),$scope.data.activated=!0})}$scope.data={},$scope.data.activated=!1,activate()}]),angular.module("interloop.settingsIntegrationsCtrl",[]).controller("settingsIntegrationsCtrl",["$scope","$rootScope","$location","$log","$timeout","$uibModal","Logger","Appuser","Org","BASE",function($scope,$rootScope,$location,$log,$timeout,$uibModal,Logger,Appuser,Org,BASE){function activate(){return Org.findOne().$promise.then(function(results){if(console.log(results),$rootScope.activeOrg=results,$location.search().redirect){var connectedApp=$location.search().app||"";"success"==$location.search().status?Logger.success("Successfully Connected "+connectedApp):"error"==$location.search().status&&Logger.error("Error Connecting "+connectedApp,"Please try again in a few moments")}$scope.data.activated=!0})["catch"](function(err){console.log("Error finding Org Data"),$scope.data.activated=!0})}var CONNECTURL=BASE.URL.replace("/api","");$scope.data={},$scope.data.activated=!1,$scope.data.connectSlackUrl=CONNECTURL+"/connect_slack",$scope.data.connectSalesforceUrl=CONNECTURL+"/connect_salesforce",$scope.data.connectMailchimpUrl=CONNECTURL+"/connect_mailchimp",activate()}]),angular.module("interloop.settingsSubscriptionCtrl",[]).controller("settingsSubscriptionCtrl",["$scope","$rootScope","$http","$q","$timeout","$window","Logger","Appuser","Org","modalManager",function($scope,$rootScope,$http,$q,$timeout,$window,Logger,Appuser,Org,modalManager){function activate(){return Org.findOne().$promise.then(function(results){$scope.data.thisOrg=results,$scope.data.activated=!0})}function editBillingDetails(){modalManager.openModal("invoiceDetails")}$scope.data={},$scope.data.activated=!1,$scope.editBillingDetails=editBillingDetails,activate()}]),angular.module("interloop.settingsInvoicesCtrl",[]).controller("settingsInvoicesCtrl",["$scope","Logger",function($scope,Logger){function save(){}$scope.data={},$scope.save=save}]),angular.module("interloop.settingsFieldsCtrl",[]).controller("settingsFieldsCtrl",["$scope","$rootScope","$log","$timeout","$uibModal","$injector","Logger","Appuser","Team",function($scope,$rootScope,$log,$timeout,$uibModal,$injector,Logger,Appuser,Team){function activate(){}function changeEntity(entity){$scope.data.currentEntity=entity,$scope.data.fields=$injector.get($scope.data.currentEntity+"Fields")}$scope.data={},$scope.data.currentEntity="Opportunity",$scope.data.fields=$injector.get($scope.data.currentEntity+"Fields"),$scope.data.activated=!0,$scope.changeEntity=changeEntity,activate()}]),angular.module("interloop.settingsViewsCtrl",[]).controller("settingsViewsCtrl",["$scope","$rootScope","$log","$timeout","$uibModal","$injector","Logger","Appuser","View","Team",function($scope,$rootScope,$log,$timeout,$uibModal,$injector,Logger,Appuser,View,Team){function activate(){changeEntity($scope.data.currentEntity)}function changeEntity(entity){$scope.data.currentEntity=entity,View.find({filter:{where:{entity:$scope.data.currentEntity}}}).$promise.then(function(results){$scope.data.views=results})["catch"](function(err){Logger.error("Error Fetching Views")})}$scope.data={},$scope.data.currentEntity="Opportunity",$scope.data.activated=!0,$scope.changeEntity=changeEntity,activate()}]),angular.module("interloop.settingsTagsCtrl",[]).controller("settingsTagsCtrl",["$scope","$rootScope","$log","$timeout","$uibModal","$injector","Logger","Appuser","View","Tag",function($scope,$rootScope,$log,$timeout,$uibModal,$injector,Logger,Appuser,View,Tag){function activate(){changeEntity($scope.data.currentEntity)}function changeEntity(entity){$scope.data.currentEntity=entity,Tag.find({filter:{where:{useWith:{inq:[$scope.data.currentEntity]}}}}).$promise.then(function(results){$scope.data.tags=results,console.log($scope.data.tags)})["catch"](function(err){Logger.error("Error Fetching Views")})}$scope.data={},$scope.data.currentEntity="Opportunity",$scope.data.activated=!0,$scope.changeEntity=changeEntity,activate()}]),angular.module("interloop.inviteUsersCtrl",[]).controller("inviteUsersCtrl",["$scope","$uibModalInstance","$q","Appuser","Logger",function($scope,$uibModalInstance,$q,Appuser,Logger){function addNewChoice(){var newItemNo=$scope.data.invitees.length+1;$scope.data.invitees.push({id:newItemNo})}function removeItem(invite){var index=$scope.data.invitees.indexOf(invite);$scope.data.invitees.splice(index,1)}function ok(){var newUserPromises=[];_.forEach($scope.data.invitees,function(invite,key){newUserPromises.push(Appuser.create({email:invite.email,firstName:invite.first||null,lastName:invite.last||null,password:randomString()}).$promise)}),$q.all(newUserPromises).then(function(results){console.log(results),Logger.info("Successfully Sent Invites"),$uibModalInstance.close(results)})["catch"](function(err){Logger.error("Error Sending Invites"),$uibModalInstance.dismiss("cancel")})}function cancel(){$uibModalInstance.dismiss("cancel")}function randomString(){for(var letters=["a","b","c","d","e","f","g","h","i","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],numbers=[0,1,2,3,4,5,6,7,8,9],randomstring="",i=0;i<5;i++){var rlet=Math.floor(Math.random()*letters.length);randomstring+=letters[rlet]}for(var i=0;i<3;i++){var rnum=Math.floor(Math.random()*numbers.length);randomstring+=numbers[rnum]}return randomstring}$scope.data={},$scope.data.invitees=[{id:"1"}],$scope.addNewChoice=addNewChoice,$scope.removeItem=removeItem,$scope.ok=ok,$scope.cancel=cancel}]),angular.module("interloop.newActivityCtrl",[]).controller("newActivityCtrl",["$scope","$uibModalInstance","searchService",function($scope,$uibModalInstance,searchService){function lookupEntities(query){return searchService.globalSearch(query).then(function(results){$scope.data.results=results})}function ok(){$uibModalInstance.close($scope.data)}function cancel(){$uibModalInstance.dismiss("cancel")}$scope.data={},$scope.activity={},$scope.people=[{label:"Joe"},{label:"Mike"},{label:"Diane"}],$scope.lookupEntities=lookupEntities,$scope.ok=ok,$scope.cancel=cancel}]),angular.module("interloop.newNoteCtrl",[]).controller("newNoteCtrl",["$scope","$uibModalInstance","searchService",function($scope,$uibModalInstance,searchService){function lookupEntities(query){return searchService.globalSearch(query).then(function(results){$scope.data.results=results})}function ok(){$uibModalInstance.close($scope.data)}function cancel(){$uibModalInstance.dismiss("cancel")}$scope.data={},$scope.lookupEntities=lookupEntities,$scope.ok=ok,$scope.cancel=cancel}]),angular.module("interloop.newOpportunityCtrl",[]).controller("newOpportunityCtrl",["$scope","$uibModalInstance",function($scope,$uibModalInstance){function ok(){$uibModalInstance.close($scope.data)}function cancel(){$uibModalInstance.dismiss("cancel")}$scope.ok=ok,$scope.cancel=cancel}]),angular.module("interloop.newContactCtrl",[]).controller("newContactCtrl",["$scope","$uibModalInstance","$timeout","$document","hotkeys","modalManager","emailTypes","phoneTypes","searchService","socialTypes","newEntityFactory",function($scope,$uibModalInstance,$timeout,$document,hotkeys,modalManager,emailTypes,phoneTypes,searchService,socialTypes,newEntityFactory){function lookupKeydown($event,companies){13!=$event.keyCode||companies.length||(console.log("enter!"),modalManager.openModal("newCompany"))}function lookupCompanies(query){return searchService.entitySearch("Company",query).then(function(results){console.log(results),$scope.data.companies=results})}function addEmail(){$scope.data.contact.emails.push({value:"",type:"work"}),$timeout(function(){angular.element("#email-"+($scope.data.contact.emails.length-1)).focus()},100)}function addPhone(){$scope.data.contact.phones.push({value:"",type:"work"}),$timeout(function(){angular.element("#phone-"+($scope.data.contact.emails.length-1)).focus()},100)}function addSocial(){$scope.data.contact.social.push({value:"",type:"linkedin"}),$timeout(function(){angular.element("#social-"+($scope.data.contact.emails.length-1)).focus()},100)}function ok(){$uibModalInstance.close($scope.data)}function cancel(){$uibModalInstance.dismiss("cancel")}function keydown($event,dropdownId){40==$event.keyCode&&($scope.data[dropdownId]=!0)}function create(){newEntityFactory.createNew("Contact",$scope.data.contact).$promise.then(function(results){console.log(results),$uibModalInstance.close(results),Logger.info("Succesfully Created Contact")})["catch"](function(err){Logger.error("Error Creating Contact","Please try again in a moment")})}$scope.data={},$scope.data.companies=[],$scope.data.emailTypes=emailTypes,$scope.data.phoneTypes=phoneTypes,$scope.data.socialTypes=socialTypes,$scope.data.contact={},$scope.data.contact.emails=[{value:"",type:"work"}],$scope.data.contact.phones=[{value:"",type:"work"}],$scope.data.contact.social=[{value:"",type:"linkedin"}],$scope.lookupCompanies=lookupCompanies,$scope.addEmail=addEmail,$scope.addPhone=addPhone,$scope.addSocial=addSocial,$scope.ok=ok,$scope.cancel=cancel,$scope.lookupKeydown=lookupKeydown,$scope.keydown=keydown,$scope.create=create}]),angular.module("interloop.newCompanyCtrl",[]).controller("newCompanyCtrl",["$scope","$uibModalInstance","hotkeys","modalManager","emailTypes","phoneTypes","searchService","socialTypes","newEntityFactory",function($scope,$uibModalInstance,hotkeys,modalManager,emailTypes,phoneTypes,searchService,socialTypes,newEntityFactory){function addEmail(){$scope.data.company.emails.push({value:"",type:"work"}),$timeout(function(){angular.element("#email-"+($scope.data.company.emails.length-1)).focus()},100)}function addPhone(){$scope.data.company.phones.push({value:"",type:"work"}),$timeout(function(){angular.element("#phone-"+($scope.data.company.emails.length-1)).focus()},100)}function addSocial(){$scope.data.company.social.push({value:"",type:"linkedin"}),$timeout(function(){angular.element("#social-"+($scope.data.company.emails.length-1)).focus()},100)}function ok(){$uibModalInstance.close($scope.data)}function cancel(){$uibModalInstance.dismiss("cancel")}function create(){newEntityFactory.createNew("Company",$scope.data.company).$promise.then(function(results){console.log(results),$uibModalInstance.close(results),Logger.info("Succesfully Created Company")})["catch"](function(err){Logger.error("Error Creating Company","Please try again in a moment")})}$scope.data={},$scope.data.emailTypes=emailTypes,$scope.data.phoneTypes=phoneTypes,$scope.data.socialTypes=socialTypes,$scope.data.company={},$scope.data.company.emails=[{value:"",type:"work"}],$scope.data.company.phones=[{value:"",type:"work"}],$scope.data.company.social=[{value:"",type:"linkedin"}],$scope.addEmail=addEmail,$scope.addPhone=addPhone,$scope.addSocial=addSocial,$scope.ok=ok,$scope.cancel=cancel,$scope.create=create}]),angular.module("interloop.wonReasonCtrl",[]).controller("wonReasonCtrl",["$scope","$rootScope","$log","$timeout","$uibModalInstance","Logger","Value","thisOpp","Opportunity","Reasons",function($scope,$rootScope,$log,$timeout,$uibModalInstance,Logger,Value,thisOpp,Opportunity,Reasons){function save(){Opportunity.prototype$patchAttributes({id:$scope.data.thisOpp.id},{status:$scope.data.value,wonReason:$scope.data.wonReason,wonDetails:$scope.data.wonDetails,lostReason:{},lostDetails:"",actualClose:moment().format()}).$promise.then(function(result){Logger.success("Won Opportunity"),$uibModalInstance.close(result)})["catch"](function(err){Logger.error("Error Updating Opportunity")})}function cancel(){$uibModalInstance.dismiss("cancel");
}$scope.data={},$scope.data.thisOpp=thisOpp,$scope.data.value=Value,$scope.data.wonReason=null,$scope.data.reasons=Reasons.items,$scope.save=save,$scope.cancel=cancel}]),angular.module("interloop.lostReasonCtrl",[]).controller("lostReasonCtrl",["$scope","$rootScope","$log","$timeout","$uibModalInstance","Logger","Value","thisOpp","Opportunity","Reasons",function($scope,$rootScope,$log,$timeout,$uibModalInstance,Logger,Value,thisOpp,Opportunity,Reasons){function save(){Opportunity.prototype$patchAttributes({id:$scope.data.thisOpp.id},{status:$scope.data.value,lostReason:$scope.data.lostReason,lostDetails:$scope.data.lostDetails,wonReason:{},wonDetails:"",actualClose:moment().format()}).$promise.then(function(result){Logger.info("Lost Opportunity"),$uibModalInstance.close(result)})["catch"](function(err){Logger.error("Error Updating Opportunity")})}function cancel(){$uibModalInstance.dismiss("cancel")}$scope.data={},$scope.data.thisOpp=thisOpp,$scope.data.value=Value,$scope.data.lostReason=null,$scope.data.reasons=Reasons.items,$scope.save=save,$scope.cancel=cancel}]),angular.module("interloop.createViewCtrl",[]).controller("createViewCtrl",["$scope","$uibModalInstance","resolvedData","newEntityFactory","Logger",function($scope,$uibModalInstance,resolvedData,newEntityFactory,Logger){function ok(){newEntityFactory.createNew("View",$scope.data.view).then(function(results){Logger.info("Successfully created view"),$uibModalInstance.close(results)})["catch"](function(err){Logger.error("Error Creating View"),$uibModalInstance.dismiss("cancel")})}function cancel(){$uibModalInstance.dismiss("cancel")}$scope.data={},$scope.data.view=resolvedData,console.log($scope.data.view),$scope.ok=ok,$scope.cancel=cancel}]),angular.module("interloop.editViewCtrl",[]).controller("editViewCtrl",["$scope","$uibModalInstance","resolvedData","newEntityFactory","View","Logger",function($scope,$uibModalInstance,resolvedData,newEntityFactory,View,Logger){function ok(){View.prototype$patchAttributes({id:$scope.data.view.id},{name:$scope.data.view.name}).$promise.then(function(results){Logger.info("Saved View"),$uibModalInstance.close(results)})["catch"](function(err){Logger.error("Error Saving View")})}function cancel(){$uibModalInstance.dismiss("cancel")}$scope.data={},$scope.data.view=resolvedData,$scope.ok=ok,$scope.cancel=cancel}]),angular.module("interloop.deleteViewCtrl",[]).controller("deleteViewCtrl",["$scope","$rootScope","$uibModalInstance","$log","$timeout","$state","$http","Logger","ViewManager","resolvedData","View",function($scope,$rootScope,$uibModalInstance,$log,$timeout,$state,$http,Logger,ViewManager,resolvedData,View){function ok(){return $scope.data.view.id==$rootScope.activeUser.defaultViews.opportunity?void Logger.error("Cannot Delete Default View","Change Default to Delete"):void View.deleteById({id:$scope.data.view.id}).$promise.then(function(results){Logger.info("Succesfully Deleted View"),$state.go("app.main.opportunities",{viewId:"default"}),$uibModalInstance.close()})["catch"](function(err){Logger.error("Error Deleting View"),$uibModalInstance.close()})}function cancel(){$uibModalInstance.dismiss("cancel")}$scope.data={},$scope.data.view=resolvedData,$scope.ok=ok,$scope.cancel=cancel}]),angular.module("interloop.bulkAssignCtrl",[]).controller("bulkAssignCtrl",["$scope","$uibModalInstance","Appuser","Logger","resolvedData",function($scope,$uibModalInstance,Appuser,Logger,resolvedData){function activate(){Appuser.find().$promise.then(function(results){$scope.data.owners=results})["catch"](function(err){Logger.error("Error Retrieving Owners","Please Try again in a moment")})}function ok(){$uibModalInstance.close($scope.data)}function cancel(){$uibModalInstance.dismiss("cancel")}$scope.data={},$scope.data.selectedItems=resolvedData.selectedItems,$scope.ok=ok,$scope.cancel=cancel,activate()}]),angular.module("interloop.bulkTagCtrl",[]).controller("bulkTagCtrl",["$scope","$uibModalInstance","Tag","resolvedData",function($scope,$uibModalInstance,Tag,resolvedData){function activate(){Tag.find({filter:{where:{useWith:{inq:[entity]}}}}).$promise.then(function(results){$scope.data.tags=results,console.log($scope.data.tags)})["catch"](function(err){Logger.error("Error Fetching Views")})}function ok(){$uibModalInstance.close($scope.data)}function cancel(){$uibModalInstance.dismiss("cancel")}function shouldDisable(){return("existing"!=$scope.data.tagType||!$scope.data.selectedTag)&&("new"!=$scope.data.tagType||!$scope.data.newTag)}var entity=resolvedData.entity;$scope.data={},$scope.data.selectedItems=resolvedData.selectedItems,$scope.data.selectedTag=null,$scope.data.newTag=null,$scope.data.tagType="existing",$scope.ok=ok,$scope.cancel=cancel,$scope.shouldDisable=shouldDisable,activate()}]),angular.module("interloop.bulkDeleteCtrl",[]).controller("bulkDeleteCtrl",["$scope","$uibModalInstance","$injector","resolvedData","Logger","gridManager","$q",function($scope,$uibModalInstance,$injector,resolvedData,Logger,gridManager,$q){function ok(){var deletePromises=[];_.forEach($scope.data.selectedItems,function(value,key){deletePromises.push(entityModel.deleteById({id:value.id}).$promise)}),$q.all(deletePromises).then(function(results){console.log(results),Logger.info("Deleted "+$scope.data.selectedItems.length+" Records"),gridManager.refreshInfinitePageCache(),$uibModalInstance.close(results)})["catch"](function(err){console.log(err),Logger.error("Error Deleting Some Records"),$uibModalInstance.dismiss("cancel")})}function cancel(){$uibModalInstance.dismiss("cancel")}var entity=resolvedData.entity,entityModel=$injector.get(entity);$scope.data={},$scope.data.selectedOption={},$scope.ok=ok,$scope.cancel=cancel,$scope.data.selectedItems=resolvedData.selectedItems}]),angular.module("interloop.bulkEditCtrl",[]).controller("bulkEditCtrl",["$scope","$uibModalInstance","$injector","$timeout","resolvedData","Logger","gridManager","$q",function($scope,$uibModalInstance,$injector,$timeout,resolvedData,Logger,gridManager,$q){function ok(){var updatePromises=[];_.forEach($scope.data.selectedItems,function(value,key){console.log(value.id);var promiseObject={};promiseObject[$scope.data.selectedOption.field]="category"==$scope.data.selectedOption.type?JSON.parse($scope.data.value):$scope.data.value,updatePromises.push(entityModel.prototype$patchAttributes({id:value.id},promiseObject).$promise)}),$q.all(updatePromises).then(function(results){console.log(results),gridManager.refreshInfinitePageCache(),$timeout(function(){Logger.info("Updated "+$scope.data.selectedItems.length+" Records")},750),$uibModalInstance.close(results)})["catch"](function(err){console.log(err),Logger.error("Error Updating Some Records"),$uibModalInstance.dismiss("cancel")})}function cancel(){$uibModalInstance.dismiss("cancel")}var entity=resolvedData.entity,entityModel=$injector.get(entity);$scope.data={},$scope.data.selectedOption={},$scope.data.value=null,$scope.data.fields=_.pickBy($injector.get(entity+"Fields"),function(value,key){return!value.excludeBulk}),$scope.ok=ok,$scope.cancel=cancel,$scope.data.selectedItems=resolvedData.selectedItems}]),angular.module("interloop.exportDataCtrl",[]).controller("exportDataCtrl",["$scope","$uibModalInstance","resolvedData",function($scope,$uibModalInstance,resolvedData){function getExport(){return $scope.data.selectedItems}function ok(){$uibModalInstance.close($scope.data)}function cancel(){$uibModalInstance.dismiss("cancel")}$scope.data={},$scope.data.selectedItems=resolvedData.selectedItems,console.log($scope.data.selectedItems),$scope.data.fileName=$scope.data.selectedItems.length+" Records",$scope.ok=ok,$scope.cancel=cancel,$scope.getExport=getExport}]),angular.module("interloop.importDataCtrl",[]).controller("importDataCtrl",["$scope","$uibModalInstance","resolvedData",function($scope,$uibModalInstance,resolvedData){function ok(){$uibModalInstance.close($scope.data)}function cancel(){$uibModalInstance.dismiss("cancel")}resolvedData.entity;$scope.data={},$scope.data={},$scope.data.selectedOption={},$scope.data.value=null,$scope.ok=ok,$scope.cancel=cancel}]),angular.module("interloop.manageTagsCtrl",[]).controller("manageTagsCtrl",["$scope","$uibModalInstance",function($scope,$uibModalInstance){function ok(){$uibModalInstance.close($scope.data)}function cancel(){$uibModalInstance.dismiss("cancel")}$scope.ok=ok,$scope.cancel=cancel}]),angular.module("interloop.fileUploadCtrl",[]).controller("fileUploadCtrl",["$scope","BASE","$uibModalInstance","resolvedData","Upload",function($scope,BASE,$uibModalInstance,resolvedData,Upload){function ok(){Upload.upload({url:BASE.URL+"/api/attachments/upload",data:{file:$scope.data.file}}).then(function(resp){console.log("Success "+resp.config.data.file.name+"uploaded. Response: "+resp.data)},function(resp){console.log("Error status: "+resp.status)},function(evt){var progressPercentage=parseInt(100*evt.loaded/evt.total);console.log("progress: "+progressPercentage+"% "+evt.config.data.file.name)}),$uibModalInstance.close($scope.data)}function cancel(){$uibModalInstance.dismiss("cancel")}$scope.data={},$scope.data.file=resolvedData,$scope.ok=ok,$scope.cancel=cancel}]),angular.module("interloop.confirmCtrl",[]).controller("confirmCtrl",["$scope","$uibModalInstance",function($scope,$uibModalInstance){function ok(){$uibModalInstance.close()}function cancel(){$uibModalInstance.dismiss("cancel")}$scope.data={},$scope.ok=ok,$scope.cancel=cancel}]),angular.module("interloop.directive.permission",[]).directive("permission",["authService",function(authService){return{restrict:"A",scope:{permission:"="},link:function(scope,elem,attrs){scope.$watch(authService.isAuthenticated,function(){authService.userHasPermission(scope.permission)?elem.show():elem.hide()})}}}]),angular.module("interloop.directive.dynamicTitle",[]).directive("title",["$rootScope","$timeout",function($rootScope,$timeout){return{link:function(){var listener=function(event,toState){$timeout(function(){$rootScope.pageTitle=toState.data&&toState.data.pageTitle?toState.data.pageTitle:"Interloop"})};$rootScope.$on("$stateChangeSuccess",listener)}}}]),angular.module("interloop.directive.autofocus",[]).directive("autofocus",["$timeout",function($timeout){return{restrict:"A",link:function($scope,$element){$timeout(function(){$element[0].focus()})}}}]),angular.module("interloop.filter.formatDate",[]).filter("formatDate",["$filter",function($filter){var angularDateFilter=$filter("date");return function(theDate){return angularDateFilter(theDate,"MMM d, y")}}]),angular.module("interloop.filter.megaNumber",[]).filter("megaNumber",function(){return function(number,fractionSize){if(null===number)return null;if(0===number)return"0";(!fractionSize||fractionSize<0)&&(fractionSize=1);for(var abs=Math.abs(number),rounder=Math.pow(10,fractionSize),isNegative=number<0,key="",powers=[{key:"Q",value:Math.pow(10,15)},{key:"T",value:Math.pow(10,12)},{key:"B",value:Math.pow(10,9)},{key:"M",value:Math.pow(10,6)},{key:"K",value:1e3}],i=0;i<powers.length;i++){var reduced=abs/powers[i].value;if(reduced=Math.round(reduced*rounder)/rounder,reduced>=1){abs=reduced,key=powers[i].key;break}}return(isNegative?"-":"")+abs+key}}),angular.module("interloop.factory.logger",[]).factory("Logger",["$log","toastr",function($log,toastr){function error(title,message,data){toastr.error(message,title),$log.error("Error: "+message,data)}function info(title,message,data){toastr.info(message,title),$log.info("Info: "+message,data)}function success(title,message,data){toastr.success(message,title),$log.info("Success: "+message,data)}function warning(title,message,data){toastr.warning(message,title),$log.warning("Warning: "+message,data)}var logger={showToasts:!0,error:error,info:info,success:success,warning:warning,log:$log.log};return logger}]),angular.module("interloop.factory.configService",[]).factory("configService",["$rootScope","$q","$timeout","$intercom","$state","$pusher","LoopBackAuth","Appuser","Org",function($rootScope,$q,$timeout,$intercom,$state,$pusher,LoopBackAuth,Appuser,Org){function init(){return console.log("init"),$q.all([Appuser.findById({id:Appuser.getCurrentId()}).$promise,Org.findOne().$promise]).then(function(results){return console.log(results),$rootScope.activeUser=results[0],$rootScope.activeOrg=results[1],console.log($rootScope.activeOrg),notificationsChannel.bind("new_notification",function(data){console.log("new notification")}),$intercom.boot({app_id:"vp6k9wou",id:Appuser.getCurrentId(),name:$rootScope.activeUser.fullName,email:$rootScope.activeUser.email,created_at:$rootScope.activeUser.createdOn}),{test:"test"}})["catch"](function(err){LoopBackAuth.clearUser(),LoopBackAuth.clearStorage(),$state.go("login")})}function shutDown(){$rootScope.activeOrg=null,$rootScope.activeUser=null,notificationsChannel.unbind("new_notification"),pusher.unsubscribe(notificationsChannelName),$intercom.shutdown(),$state.go("login")}var pusher=$pusher(client),notificationsChannelName="notifications-"+Appuser.getCurrentId(),notificationsChannel=pusher.subscribe(notificationsChannelName),configService={init:init,shutDown:shutDown};return configService}]),angular.module("interloop.factory.authService",[]).constant("authEvents",{LOGIN_SUCCESS:"auth_login_success",LOGIN_FAILED:"auth_login_failed",LOGOUT_SUCCESS:"auth_logout_success",LOGOUT_FAILED:"auth_logout_failed",RESET_SUCCESS:"auth_reset_success",RESET_FAILED:"auth_reset_failed",UPDATE_SUCCESS:"auth_update_success",UPDATE_FAILED:"auth_update_failed",SESSION_TIMEOUT:"auth_session_timeout",NOT_AUTHENTICATED:"auth_not_authenticated"}).factory("authService",["Appuser","Org","authEvents","$rootScope","$location","$http","LoopBackAuth","Permissions",function(Appuser,Org,authEvents,$rootScope,$location,$http,LoopBackAuth,Permissions){function login(email,password,rememberMe){return Appuser.login({email:email,password:password,rememberMe:rememberMe}).$promise.then(function(response){var next=$location.nextAfterLogin||"/contacts";$location.nextAfterLogin=null,"/login"==next&&(next="/contacts"),$location.path(next),$rootScope.$broadcast(authEvents.LOGIN_SUCCESS)},function(){$rootScope.$broadcast(authEvents.LOGIN_FAILED)})}function logout(){return Appuser.logout().$promise.then(function(response){$rootScope.$broadcast(authEvents.LOGOUT_SUCCESS)},function(){$rootScope.$broadcast(authEvents.LOGOUT_FAILED)})}function resetPassword(email){return Appuser.resetPassword({email:email}).$promise.then(function(response){$rootScope.$broadcast(authEvents.RESET_SUCCESS)})["catch"](function(err){$rootScope.$broadcast(authEvents.RESET_FAILED,{error:err})})}function register(email,password){return Appuser.create({email:email,password:password}).$promise}function isAuthenticated(){return Appuser.isAuthenticated()}function getCurrentAppuserId(){return Appuser.getCurrentId()}function getCurrentAppuser(){return Appuser.findById({id:Appuser.getCurrentId()})}function getCurrentOrg(){return Org.findOne().$promise}function userHasPermissionForView(view){return!view.permissions||!view.permissions.length||userHasPermission(view.permissions)}function userHasPermission(permissions){var intersectRoles=[];if(_.has($rootScope.activeUser,"roles")){var tempPermissionsArray=[];_.forEach($rootScope.activeUser.roles,function(value,key){var thisPermissions=_.isNil(_.find(Permissions,["name",value]))||_.isNil(_.find(Permissions,["name",value])).permissions?[]:_.find(Permissions,["name",value]).permissions;tempPermissionsArray.push(thisPermissions)})}var allowedPermissions=_.uniqWith(_.flattenDeep(tempPermissionsArray),_.isEqual);return intersectRoles=_.intersection(permissions,allowedPermissions),!!intersectRoles.length}var service={login:login,logout:logout,register:register,resetPassword:resetPassword,isAuthenticated:isAuthenticated,getCurrentAppuser:getCurrentAppuser,getCurrentAppuserId:getCurrentAppuserId,getCurrentOrg:getCurrentOrg,userHasPermissionForView:userHasPermissionForView,userHasPermission:userHasPermission};return service}]),angular.module("interloop.factory.newEntityFactory",[]).factory("newEntityFactory",["$log","$rootScope","$uibModal","$q","$http","$injector","searchEntities","entityTypes",function($log,$rootScope,$uibModal,$q,$http,$injector,searchEntities,entityTypes){function createNew(entityType,entity){var entityModel=$injector.get(entityType),currentUser={id:$rootScope.activeUser.id,initials:$rootScope.activeUser.initials,fullName:$rootScope.activeUser.fullName,avatar:$rootScope.activeUser.avatar};return entity.updatedBy=currentUser,entity.createdBy=currentUser,entityModel.create(entity).$promise}var newEntityFactory={createNew:createNew};return newEntityFactory}]),angular.module("interloop.factory.modalManager",[]).factory("modalManager",["$log","$uibModal","modalDefs",function($log,$uibModal,modalDefs){function openModal(modalName,_resolvedData){var thisModal=modalDefs[modalName]||null,modalInstance=$uibModal.open({animation:!0,backdrop:"static",windowClass:"modal-fade-in-scale-up",ariaLabelledBy:thisModal.ariaLabelledBy||"",ariaDescribedBy:thisModal.ariaDescribedBy||"",templateUrl:thisModal.templateUrl,size:thisModal.size,controller:thisModal.controller,resolve:{resolvedData:function(){return _resolvedData||null}}});return modalInstance.result.then(function(returnVal,$q,$timeout){},function(){$log.log("dismissed modal")}),modalInstance}var modalManager={openModal:openModal};return modalManager}]),angular.module("interloop.factory.gridManager",[]).factory("gridManager",["$rootScope","$q","$timeout","$injector","$state","searchService","View","EndFields","RelationshipManager","QueryBuilder",function($rootScope,$q,$timeout,$injector,$state,searchService,View,EndFields,RelationshipManager,QueryBuilder){function initGrid(entityType,thisView){initializing=!0;var defer=$q.defer();selectedData.items=[],currentEntityType=entityType,currentView=thisView,currentQuery=angular.fromJson(currentView.query)||{filter:{}},lastRow=currentView.count;var entityFields=angular.copy(_.filter($injector.get(currentEntityType+"Fields"),["excludeGrid",!1])),endFields=EndFields,entityDefs=[];_.forOwn(_.merge(entityFields,endFields),function(value,key){var columnObject={headerName:value.label,field:value.field};value.colId&&(columnObject.colId=value.colId),value.width&&(columnObject.width=value.width),value.pinned&&(columnObject.pinned=value.pinned),value.hide&&(columnObject.hide=value.hide),value.valueGetter&&(columnObject.valueGetter=value.valueGetter),value.headerValueGetter&&(columnObject.headerValueGetter=value.headerValueGetter),value.filter&&(columnObject.filter=value.filter),value.headerClass&&(columnObject.headerClass=value.headerClass),value.cellClass&&(columnObject.cellClass=value.cellClass),value.cellRenderer&&(columnObject.cellRenderer=value.cellRenderer),value.keyCreator&&(columnObject.keyCreator=value.keyCreator),"category"==value.type&&(columnObject.enableRowGroup=!0),entityDefs.push(columnObject)});var columnDefs=unPackColumnDefs(baseDefs.concat(entityDefs)),options={columnDefs:columnDefs,rowData:null,rowModelType:"infinite",paginationPageSize:paginationSize,paginationOverflowSize:2,maxConcurrentDatasourceRequests:3,infiniteInitialRowCount:0,maxPagesInCache:5,getRowNodeId:function(item){return item.id.toString()},headerHeight:40,rowHeight:50,enableColResize:!0,showToolPanel:!1,unSortIcon:!1,enableServerSideSorting:!0,enableServerSideFilter:!0,animateRows:!1,suppressRowClickSelection:!0,rowSelection:"multiple",overlayLoadingTemplate:'<div class="loop-loader loop-loader-xs">Loading...</div>',icons:{sortAscending:'<img src="./assets/img/grid/sortAscending.svg" style="width: 20px;"/>',sortDescending:'<img src="./assets/img/grid/sortDescending.svg" style="width: 20px;"/>',groupExpanded:'<img src="./assets/img/grid/groupExpanded.svg" style="width: 40px; padding:10px; margin-top:-2px;"/>',groupContracted:'<img src="./assets/img/grid/groupContracted.svg" style="width: 40px; padding:10px; margin-top:-2px;"/>',checkboxChecked:'<img src="./assets/img/grid/checkboxChecked.svg" style="width: 40px; padding:10px; margin-top:-2px;"/>',checkboxUnchecked:'<img src="./assets/img/grid/checkboxUnchecked.svg" style="width: 40px; padding:10px; margin-top:-2px;"/>',checkboxIndeterminate:'<img src="./assets/img/grid/checkboxIndeterminate.svg" style="width: 40px; padding:10px; margin-top:-2px;"/>'},context:{valueType:"total",changeHistory:"none",changeHistoryDuration:7,nameFormat:"first last"},enableStatusBar:!1,enableRangeSelection:!1,suppressContextMenu:!0,suppressMenuMainPanel:!0,suppressMenuFilterPanel:!0,suppressMenuColumnPanel:!0,defaultColDef:{editable:!1,cellRenderer:defaultRender,cellClassRules:{"updated-cell-indicator":function(params){return void 0!=params.data&&(_.filter(params.data.changeHistories,["attribute",params.colDef.field]).length>0&&"indicator"==params.context.changeHistory)},"updated-cell-full":function(params){return void 0!=params.data&&(_.filter(params.data.changeHistories,["attribute",params.colDef.field]).length>0&&"full"==params.context.changeHistory)}}},onGridReady:gridReady,onRowClicked:rowClicked,onSelectionChanged:selectionChanged};return defer.resolve(options),defer.promise}function gridReady(params){console.log("gridReady!"),grid=params,grid.api.setDatasource(dataSource),$rootScope.$broadcast("GRID_READY",{})}function changeView(changeToView){grid.api.showLoadingOverlay(),currentView=changeToView,currentQuery=changeToView.query||{filter:{}},grid.api.setDatasource(dataSource),$timeout(function(){grid.api.hideOverlay()},250)}function changeCurrentQuery(filters){grid.api.showLoadingOverlay(),currentQuery.filter.where=QueryBuilder.buildQuery(filters);var entityModel=$injector.get(currentEntityType);return entityModel.metadata({filter:currentQuery.filter.where}).$promise.then(function(results){return console.log("got metadata"),lastRow=results.count||0,grid.api.setDatasource(dataSource),$timeout(function(){grid.api.hideOverlay()},250),results})["catch"](function(err){console.log(err)})}function getCurrentQuery(){return currentQuery}function rowClicked(params){void 0!==params.data&&$timeout(function(){$state.go("app.sidebar."+currentEntityType.toLowerCase()+".insights",{id:params.node.id},{reload:"app.sidebar."+currentEntityType.toLowerCase()}),$rootScope.sidePanelOpen=!0},0)}function selectionChanged(params){$timeout(function(){selectedData.items=grid.api.getSelectedRows()},0)}function purgeCache(){grid.api.purgeInfinitePageCache()}function refreshInfinitePageCache(){grid.api.refreshInfinitePageCache()}function showOverlay(){grid.api.showLoadingOverlay()}function refreshView(){console.log("refresh in factory"),grid.api.showLoadingOverlay(),grid.api.refreshView(),$timeout(function(){grid.api.hideOverlay()},250)}function clearSelected(params){selectedData.items=[],grid.api.deselectAll()}function sizeToFit(params){grid.api.sizeColumnsToFit()}function exportToExcel(params){grid.api.exportDataAsExcel({fileName:"test.xls"})}function showHideColumn(column,visible){grid.columnApi.setColumnVisible(column,visible)}function setLocalSearch(value){localSearch=value,$timeout(function(){grid.api.setDatasource(dataSource)},0)}function getLocalSearch(value){return localSearch}function getColumns(){return grid.columnApi.getAllColumns()}function getColumnState(){return grid.columnApi.getColumnState()}function getSortModel(){return grid.api.getSortModel()}function getSelectedData(){return selectedData}function setContext(contextItem,value){console.log("contextItem",contextItem),console.log("contextValue",value),grid.api.gridOptionsWrapper.gridOptions.context[contextItem]=value,grid.api.refreshHeader(),grid.api.refreshInfinitePageCache()}function getNestedValue(params){return _.get(params.data,params.colDef.field+".value",null)}function getNestedOwner(params){return _.get(params.data,params.colDef.field+".fullName",null)}function getNestedStage(params){return _.get(params.data,params.colDef.field+".score",null)}function getPrimaryCompany(params){return _.get(params.data,"entityLinks",null)?RelationshipManager.getPrimary(params.data.entityLinks,"Company"):null}function getActivityCount(params){var activityLinks=_.get(params.data,"activityLinks",null);return activityLinks?_.filter(activityLinks,["_isDeleted",!1]).length:null}function getRelatedToCount(params){var entityLinks=_.get(params.data,"entityLinks",null);return entityLinks?_.filter(entityLinks,["_isDeleted",!1]).length:null}function getLastInteraction(params){var activityLinks=_.get(params.data,"activityLinks",null);return activityLinks&&_.sortBy(activityLinks,"updatedOn")[0]?_.get(_.sortBy(activityLinks,"updatedOn")[0],"updatedOn",null):null}function getOppValueHeader(params){var valueType=params.context.valueType;switch(valueType){case"total":return"Value";case"weighted":return"Weighted Value";case"predicted":return"Predicted Value"}}function MyCellRenderer(){}function defaultRender(params){return void 0!==params.data?params.value?params.value:nullCell:'<div class="loading-data"></div>'}function starRenderer(params){var eDiv=document.createElement("div");eDiv.innerHTML='<span><button class="btn btn-link star-button"><icon class="wb-star"></icon></button></span>';var eButton=eDiv.querySelectorAll(".star-button")[0];return eButton.addEventListener("click",function(){console.log("button was clicked!!")}),eDiv}function dateRender(params){return void 0!==params.data?params.value?'<span class="date-formatted">'+moment(params.value).format("MMM D YYYY")+"</span>":nullCell:'<div class="loading-data"></div>'}function dateWithQuarterRender(params){return void 0!==params.data?params.value?'<span class="date-formatted">'+moment(params.value).format("MMM D YYYY")+'</span><span class="date-quarter">Q'+moment(params.value).quarter()+"</span>":nullCell:'<div class="loading-data"></div>'}function emailRender(params){return void 0!==params.data?params.value?'<a href="mailto:'+params.value+'">'+params.value+"</a>":nullCell:'<div class="loading-data"></div>'}function phoneRender(params){return void 0!==params.data?params.value?'<a href="tel:'+params.value+'">'+params.value+"</a>":nullCell:'<div class="loading-data"></div>'}function websiteRender(params){return void 0!==params.data?params.value?'<a href="'+params.value+'" target="_blank">'+params.value+"</a>":nullCell:'<div class="loading-data"></div>'}function currencyRender(params){return void 0!==params.data?params.value?numeral(params.value).format("$ 0,0.00"):nullCell:'<div class="loading-data"></div>'}function numberRender(params){return void 0!==params.data?params.value?numeral(params.value).format("0,0"):nullCell:'<div class="loading-data"></div>'}function tagsRender(params){if(void 0!==params.data){var html="",increment=0,tags=_.filter(params.data.itemLinks,{itemType:"Tag"});return tags.length?(_.forEach(tags,function(tag){if(increment+=1,html+='<span class="tag grid-tag">'+tag.name+"</span>",2==increment&&tags.length-2!==0)return html+='<span class="tag grid-tag"> + '+(tags.length-2)+"</span>",!1}),html):'<span class="null-cell">--</span>'}return'<div class="loading-data"></div>'}function ownerRender(params){return void 0!==params.data?params.value?params.value:nullCell:""}function oppValueRender(params){var valueType=params.context.valueType;switch(valueType){case"total":return params.value?numeral(params.value).format("$ 0,0.00"):nullCell;case"weighted":return params.value?numeral(.01*_.get(params.data.stage,"score",0)*params.value).format("$ 0,0.00"):nullCell;case"predicted":return params.value?numeral(.85*params.value).format("$ 0,0.00"):nullCell}}function primaryCompanyRender(params){return params.value?params.value.name:nullCell}function contactNameRender(params){if(void 0!==params.data){if(params.data.avatar){var template='<div class="avatar-cell">';template+='<div class="avatar" >',template+='<div class="avatar-img"><img src="'+params.data.avatar+'" alt="'+params.data.firstName+" "+params.data.lastName+'"></div>',template+="</div>",template+='<span class="avatar-name">'+params.data.firstName+" "+params.data.lastName+"</span>",template+="</div>"}else{var firstLetter=params.data.firstName?params.data.firstName.charAt(0):"",lastLetter=params.data.lastName?params.data.lastName.charAt(0):"",template='<div class="avatar-cell">';template+='<div class="avatar" >',template+=firstLetter+lastLetter,template+="</div>",template+='<span class="avatar-name">'+params.data.firstName+" "+params.data.lastName+"</span>",template+="</div>"}return params.data.firstName||params.data.lastName?template:nullCell}return'<div class="loading-data"></div>'}function companyNameRender(params){if(void 0!==params.data){if(params.data.logo){var template='<div class="avatar-cell">';template+='<div class="avatar square" >',template+='<div class="avatar-img"><img src="'+params.data.logo+'" alt="'+params.data.name+'"></div>',template+="</div>",template+='<span class="avatar-name">'+params.data.name+"</span>",template+="</div>"}else{var firstLetter=params.data.name?params.data.name.charAt(0):"",template='<div class="avatar-cell">';template+='<div class="avatar square">',template+=firstLetter,template+="</div>",template+='<span class="avatar-name">'+params.data.name+"</span>",template+="</div>"}return params.value?template:nullCell}return'<div class="loading-data"></div>'}function ownerRender(params){if(void 0!==params.data){var owner=_.get(params.data,params.colDef.field+".fullName",null),initials=(_.get(params.data,params.colDef.field+".avatar",null),_.get(params.data,params.colDef.field+".initials",null));return owner?'<div class="oppOwnerCell"><span class="avatar avatar-sm"><span>'+initials+'</span></span><span class="avatar-name">'+owner+"</span></div>":nullCell}return'<div class="loading-data"></div>'}function oppStageRender(params){if(void 0!==params.data){var percent=(_.get(params.data,params.colDef.field+".order",0),_.get(params.data,params.colDef.field+".score","--")),value=_.get(params.data,params.colDef.field+".value","N/A");return params.data.stage?'<div class="oppStageCell"><span class="oppStageCell-number">'+percent+'%</span><span class="oppStageCell-name pull-right">'+value+"</span></div>":nullCell}return'<div class="loading-data"></div>'}function oppStatusRender(params){if(void 0!==params.data){var color=_.get(params.data,params.colDef.field+".color",null),status=_.get(params.data,params.colDef.field+".label",null);return null!=status?'<div class="oppStatusCell show-ellipsis"><icon style="color:'+color+';" class="wb-medium-point text-inline"></icon>'+status+"</div>":nullCell}return'<div class="loading-data"></div>'}function unPackColumnDefs(columnDefs){var colDefsWithFunctions=["cellRenderer","headerCellRenderer","valueGetter","headerValueGetter","headerCellTemplate","cellClass","comparator","getQuickFilterText","aggFunc"],newColumnDefs=angular.copy(columnDefs);return _.forEach(newColumnDefs,function(columnDef){_.forEach(columnDef,function(value,key){_.includes(colDefsWithFunctions,key)&&(columnDef[key]=_.has(gridFuncs,value)?gridFuncs[value]:value)})}),newColumnDefs}var _gridFuncs,grid=null,localSearch="",paginationSize=100,currentEntityType=null,currentQuery={},lastRow=null,prevSortModel=null,currentView=null,selectedData={items:[]},initializing=!1,nullCell='<span class="null-cell">--</span>',baseDefs=[{headerName:"--",field:"select",headerClass:"text-center",cellClass:"no-padding no-row-click",headerCheckboxSelectionFilteredOnly:!0,checkboxSelection:!0,width:45,suppressSizeToFit:!0,suppressMovable:!0,suppressResize:!0,suppressSorting:!0,pinned:"left"},{headerName:"--",field:"star",headerClass:"text-center",cellRenderer:starRenderer,cellClass:"no-padding no-row-click",width:45,suppressSizeToFit:!0,suppressMovable:!0,suppressResize:!0,suppressSorting:!0,pinned:"left"}],dataSource={getRows:function(params){if(console.log("asking for "+params.startRow+" to "+params.endRow),params.filterModel&&console.log("filter model",params.filterModel),initializing&&grid.api.showLoadingOverlay(),currentQuery.filter.limit=paginationSize,currentQuery.filter.skip=params.startRow,params.sortModel.length&&(params.sortModel!==prevSortModel&&grid.api.showLoadingOverlay(),
prevSortModel=params.sortModel||null,currentQuery.filter.order=[],_.forEach(params.sortModel,function(value,key){var sortString=value.colId+" "+value.sort.toUpperCase();currentQuery.filter.order.push(sortString)})),"none"!==params.context.changeHistory){var numberOfDays=Number(params.context.changeHistoryDuration),beforeDate=moment().subtract(numberOfDays,"days").startOf("day").format();_.extend(currentQuery.filter,{include:{relation:"changeHistories",where:{createdOn:{gt:beforeDate}}}})}var entityModel=$injector.get(currentEntityType);switch(!0){case localSearch.length>0:return entityModel.search({searchText:localSearch,searchFilter:currentQuery.filter.where||{}}).$promise.then(function(searchResults){params.successCallback(searchResults,searchResults.length),initializing=!1,grid.api.hideOverlay(),0==results.length&&grid.api.showNoRowsOverlay()})["catch"](function(err){params.failCallback(),initializing=!1,grid.api.hideOverlay()});default:return entityModel.find(currentQuery).$promise.then(function(results){params.successCallback(results,lastRow),initializing=!1,grid.api.hideOverlay(),0==lastRow&&grid.api.showNoRowsOverlay()})["catch"](function(err){params.failCallback(),initializing=!1,grid.api.hideOverlay()})}}},gridFuncs=(_gridFuncs={getNestedValue:getNestedValue,getNestedStage:getNestedStage,contactNameRender:contactNameRender,companyNameRender:companyNameRender,currencyRender:currencyRender,dateRender:dateRender,dateWithQuarterRender:dateWithQuarterRender,defaultRender:defaultRender,emailRender:emailRender,getNestedOwner:getNestedOwner,numberRender:numberRender,ownerRender:ownerRender,phoneRender:phoneRender,starRenderer:starRenderer,tagsRender:tagsRender,websiteRender:websiteRender},_defineProperty(_gridFuncs,"ownerRender",ownerRender),_defineProperty(_gridFuncs,"oppStatusRender",oppStatusRender),_defineProperty(_gridFuncs,"oppStageRender",oppStageRender),_defineProperty(_gridFuncs,"getPrimaryCompany",getPrimaryCompany),_defineProperty(_gridFuncs,"primaryCompanyRender",primaryCompanyRender),_defineProperty(_gridFuncs,"getLastInteraction",getLastInteraction),_defineProperty(_gridFuncs,"getRelatedToCount",getRelatedToCount),_defineProperty(_gridFuncs,"getActivityCount",getActivityCount),_defineProperty(_gridFuncs,"oppValueRender",oppValueRender),_defineProperty(_gridFuncs,"MyCellRenderer",MyCellRenderer),_defineProperty(_gridFuncs,"getOppValueHeader",getOppValueHeader),_gridFuncs),gridManager={initGrid:initGrid,getColumns:getColumns,getColumnState:getColumnState,getSortModel:getSortModel,getSelectedData:getSelectedData,showHideColumn:showHideColumn,changeView:changeView,changeCurrentQuery:changeCurrentQuery,getCurrentQuery:getCurrentQuery,showOverlay:showOverlay,purgeCache:purgeCache,refreshInfinitePageCache:refreshInfinitePageCache,clearSelected:clearSelected,refreshView:refreshView,sizeToFit:sizeToFit,exportToExcel:exportToExcel,setLocalSearch:setLocalSearch,getLocalSearch:getLocalSearch,setContext:setContext};return gridManager}]),angular.module("interloop.factory.queryBuilder",[]).factory("QueryBuilder",["$log","$uibModal","$q","$http","BASE","searchEntities","entityTypes",function($log,$uibModal,$q,$http,BASE,searchEntities,entityTypes){function buildQuery(filters){console.log(filters);var queryParts=[];if(_.forOwn(filters,function(filter,key){switch(filter.type){case"is":queryParts.push(_defineProperty({},key,filter.value));break;case"is-not":queryParts.push(_defineProperty({},key,{neq:filter.value}));break;case"contains":queryParts.push(_defineProperty({},key,{regexp:"/"+filter.value+"/i"}));break;case"does-not-contain":queryParts.push(_defineProperty({},key,{regexp:"^((?!"+filter.value+").)*$"}));break;case"includes":queryParts.push(_defineProperty({},key+".value",{inq:filter.value}));break;case"does-not-include":queryParts.push(_defineProperty({},key,{nin:filter.value}));break;case"is-unknown":queryParts.push({or:[_defineProperty({},key,{exists:!1}),_defineProperty({},key,null),_defineProperty({},key,"")]});break;case"has-any-value":queryParts.push(_defineProperty({},key,{neq:null}));break;case"range":queryParts.push({and:[_defineProperty({},key,{gt:filter.value}),_defineProperty({},key,{lt:filter.value})]});break;case"greater-than":queryParts.push(_defineProperty({},key,{gt:filter.value}));break;case"less-than":queryParts.push(_defineProperty({},key,{lt:filter.value}))}}),queryParts.length>1)var query={and:queryParts};else var query=queryParts[0];return console.log("builtQuery",query),query}var queryBuilder={buildQuery:buildQuery};return queryBuilder}]),angular.module("interloop.factory.viewManager",[]).factory("ViewManager",["$rootScope","$injector","$q","$uibModal","Logger","View","Appuser",function($rootScope,$injector,$q,$uibModal,Logger,View,Appuser){function getThisView(entityType,views,viewId,query){if("default"==viewId){var defer=$q.defer(),defaultViewId=$rootScope.activeUser.defaultViews[entityType]||$rootScope.activeOrg.defaultViews[entityType]||null,defaultView=_.find(views,["id",defaultViewId]);return defaultView?defer.resolve(defaultView):defer.reject("No View Found"),defer.promise}if(!query){var defer=$q.defer(),thisView=_.find(views,["id",viewId]);return thisView?defer.resolve(thisView):defer.reject("No View Found"),defer.promise}}function setDefault(view){return $rootScope.activeUser.defaultViews=$rootScope.activeUser.defaultViews||{},$rootScope.activeUser.defaultViews[view.entity]=view.id,Appuser.updateAttributes({id:$rootScope.activeUser.id},_defineProperty({},"defaultViews."+view.entity,view.id)).$promise.then(function(response){Logger.info("Default View Set Successfully")})["catch"](function(){Logger.error("Error Setting Default View")})}function clearDefault(view){return $rootScope.activeUser.defaultViews[view.entity]=null,Appuser.updateAttributes({id:$rootScope.activeUser.id},_defineProperty({},"defaultViews."+view.entity,null)).$promise.then(function(response){Logger.info("Default View Removed")})["catch"](function(){Logger.error("Error Setting Default View")})}var ViewManager={getThisView:getThisView,setDefault:setDefault,clearDefault:clearDefault};return ViewManager}]),angular.module("interloop.factory.sidebarRouter",[]).factory("SidebarRouter",["$rootScope","$stickyState","$state","$stateParams","$injector","$timeout","$q","Logger",function($rootScope,$stickyState,$state,$stateParams,$injector,$timeout,$q,Logger){function getSidebarBackState(){var defer=$q.defer();return defer.resolve(sidebarHistory[sidebarHistory.length-1]),defer.promise}function pushHistory(state){var defer=$q.defer();return sidebarHistory.push(state),defer.resolve("pushed state to history"),defer.promise}function getHistory(){var defer=$q.defer();return defer.resolve(sidebarHistory),defer.promise}var sidebarHistory=[],SidebarRouter={getSidebarBackState:getSidebarBackState,pushHistory:pushHistory,getHistory:getHistory};return SidebarRouter}]),angular.module("interloop.factory.sidebarActions",[]).factory("SidebarActions",["$document","$http","$rootScope","$uibModal","$q","$log","$injector","Appuser","Activity","Logger","modalManager","RelationshipManager","SidebarRouter",function($document,$http,$rootScope,$uibModal,$q,$log,$injector,Appuser,Activity,Logger,modalManager,RelationshipManager,SidebarRouter){function getTags(items){var defer=$q.defer(),tags=_.filter(items,{itemType:"Tag"});return defer.resolve(tags),defer.promise}function getAddresses(items){var defer=$q.defer(),addresses=_.get(items,"addresses",[]);return defer.resolve(addresses),defer.promise}function getFiles(items){var defer=$q.defer(),files=_.filter(items,{itemType:"File"});return defer.resolve(files),defer.promise}function getOpenActivities(activities){var defer=$q.defer(),openActivities=_.filter(activities,function(o){return _.has(o,"activity")&&o.activity.completed!==!0&&o.activity.type&&"Note"!==o.activity.type.value&&"Status_Change"!==o.activity.type.value});return defer.resolve(openActivities),defer.promise}function getHistory(activities){var defer=$q.defer(),history=_.filter(activities,function(o){return _.has(o,"activity")&&1==o.activity.completed&&_.isString(o.type)});return defer.resolve(history),defer.promise}function getStarred(entityItem){var isStarred=!_.isNil(_.find(_.get($rootScope.activeUser,"starredLinks",[]),["itemId",entityItem.id]));return isStarred}function starItem(entityType,entityItem){var name="";name="Contact"==entityType?entityItem.fullName||"":entityItem.name||"";var starObject={name:name,itemId:entityItem.id,itemType:entityType};return Appuser.prototype$__create__starredItems({id:Appuser.getCurrentId()},starObject).$promise.then(function(response){return response})}function unStarItem(entityItem){return Appuser.prototype$__destroyById__starredItems({id:Appuser.getCurrentId()},{fk:entityItem.id}).$promise.then(function(response){return response})}function cloneItem(entityType,entityItem,owners){Logger.info("Cloning...");var clonedItem=angular.copy(entityItem);clonedItem.name=clonedItem.name+"-copy",delete clonedItem.id;var currentUser=_.pick($rootScope.activeUser,["id","fullName"]);clonedItem.createdBy=currentUser,clonedItem.updatedBy=currentUser,clonedItem.updatedOn=moment().format(),clonedItem.createdOn=moment().format(),"Opportunity"==entityType&&(clonedItem.owner=_.find(owners,{id:currentUser.id}),clonedItem.stage=clonedItem.process.stages[0],clonedItem.activityLinks=[],clonedItem.entityLinks=[],clonedItem.itemLinks=_.filter(clonedItem.itemLinks,function(o){return"Tag"==o.itemType}),clonedItem.wonDetails=null,clonedItem.wonReason={},clonedItem.lostDetails=null,clonedItem.lostReason={},clonedItem.actualClose=null,_.forEach(clonedItem.process.stages,function(value,key){value.completed=!1,value.completedDate=null,_.forEach(value.steps,function(step,key){step.completed=!1})}));var entityModel=$injector.get(entityType);return entityModel.create(clonedItem).$promise.then(function(result){return result})["catch"](function(err){Logger.error("Error Cloning "+entityType),Logger.log("failed to clone - "+err)})}function deleteItem(entityType,entityItem){var entityModel=$injector.get(entityType);return entityModel.deleteById({id:entityItem.id}).$promise.then(function(result){return result})["catch"](function(err){Logger.error("Error Deleting "+entityType),Logger.log("failed to delete - "+err)})}function unArchiveItem(entityType,entityItem){var entityModel=$injector.get(entityType);return entityModel.unarchive({id:entityItem.id}).$promise.then(function(results){return Logger.info(entityType+" Un-Archived"),entityItem._isDeleted=!1,entityItem.deletedAt=null,result})["catch"](function(err){Logger.error("Error Un-Archiving "+entityType)})}function copyShareLink(shareLink){clipboard.supported?(clipboard.copyText(shareLink),Logger.info("Copied link to Clipboard")):Logger.error("Sorry, copy to clipboard is not supported in this browser")}function manageTags(entityType,entityItem){return TagManager.manageTags(entityItem,entityType,entityItem.tags).then(function(tags){_.remove(entityItem.items,{itemType:"Tag"}),_.extend(entityItem.items,tags),_.remove(entityItem.itemLinks,{itemType:"Tag"});var strippedTags=_.map(tags,function(tag){return _.omit(tag,["item"])});_.extend(entityItem.itemLinks,strippedTags)},function(){$log.info("Modal dismissed at: "+new Date)})}function relateToWizard(entityType,entityItem,pickLists){RelationshipManager.relateToWizard(entityItem,entityType,ORG_CONFIG.relateToEntities,pickLists)}function uploadFiles(entityType,entityItem,files){_.forEach(files,function(value,key){modalManager.openModal("fileUpload",value)})}function updateActivityLink(entityModel,entityItem,activity){return entityModel.prototype$__get__activities({id:entityItem.entityId,filter:{where:{activityId:activity.id}}}).$promise.then(function(results){var activityLink=results[0];return entityModel.prototype$__updateById__activities({id:entityItem.entityId,fk:activityLink.id},{id:activityLink.id,activityId:activity.id,name:activity.name,type:_.get(activity.type,"value",{}),completed:activity.completed,completedDate:activity.completedDate}).$promise})}function completeActivity(activity){return Activity.updateAttributes({id:activity.activityId},{completed:!0,completedDate:moment().format()}).$promise.then(function(response){var updatedActivity=response,updateLinks=[];angular.forEach(response.entityLinks,function(entityLink){var entityModel=$injector.get(entityLink.entityType);updateLinks.push(updateActivityLink(entityModel,entityLink,updatedActivity))}),$q.all(updateLinks).then(function(results){return updatedActivity})})["catch"](function(err){Logger.error("Error updating "+entityType),Logger.log(err)})}function scrollRight(){var view=($document[0].getElementById("navTabsScroller").scrollWidth-$document[0].getElementById("navTabsScroller").clientWidth,angular.element($document[0].getElementById("navTabsScroller")));view.scrollLeft();view.animate({scrollLeft:"+=300"},150)}function scrollLeft(){var view=angular.element($document[0].getElementById("navTabsScroller"));parseInt(view.css("left"));view.animate({scrollLeft:"-=300"},150)}function monitorScroll(){$rootScope.showScrollRight=!0,$rootScope.showScrollLeft=!1;var view=angular.element($document[0].getElementById("navTabsScroller")),maxScrollLeft=$document[0].getElementById("navTabsScroller").scrollWidth-$document[0].getElementById("navTabsScroller").clientWidth;view.bind("scroll",function(){0==view.scrollLeft()?$rootScope.$apply(function(){$rootScope.showScrollLeft=!1}):$rootScope.$apply(function(){$rootScope.showScrollLeft=!0}),view.scrollLeft()==maxScrollLeft?$rootScope.$apply(function(){$rootScope.showScrollRight=!1}):$rootScope.$apply(function(){$rootScope.showScrollRight=!0})})}function wonReason(entityItem,value,oldValue,reasons){modalManager.openModal("wonReason")}function lostReason(entityItem,value,oldValue,reasons){modalManager.openModal("lostReason")}function saveData(entityType,entityItem,newValue,noAlert){var entityModel=$injector.get(entityType);return entityModel.patchAttributes({id:entityItem.id},newValue).$promise.then(function(response){return noAlert||Logger.info(entityType+" "+(Object.keys(newValue)[0]||"")+" updated"),response})["catch"](function(err){Logger.error("Error updating "+entityType),Logger.log(err)})}function createChangeActivity(name,type,data,entityItem){var newActivity={};newActivity.name=name||null,newActivity.type={value:type}||null,newActivity.data=data||{},newActivity.owner={fullName:$rootScope.activeUser.fullName,initials:$rootScope.activeUser.initials},newActivity.completed=!0,newActivity.completedDate=moment().format(),Activity.create(newActivity).$promise.then(function(data){var activity=data;data.id;entityItem.history.push({activity:activity}),RelationshipManager.linkActivity(activity.id,entityItem.id,"Opportunity",{activity:{name:activity.name,type:{value:activity.type},completed:activity.completed},entity:{name:entityItem.name,description:"Opportunity Activity",isPrimary:!1}})})["catch"](function(err){Logger.log(err.statusText,err.data,err.status)})}var SidebarActions={cloneItem:cloneItem,copyShareLink:copyShareLink,createChangeActivity:createChangeActivity,deleteItem:deleteItem,completeActivity:completeActivity,getAddresses:getAddresses,getFiles:getFiles,getHistory:getHistory,getOpenActivities:getOpenActivities,getStarred:getStarred,getTags:getTags,manageTags:manageTags,monitorScroll:monitorScroll,relateToWizard:relateToWizard,saveData:saveData,scrollLeft:scrollLeft,scrollRight:scrollRight,unArchiveItem:unArchiveItem,uploadFiles:uploadFiles,starItem:starItem,unStarItem:unStarItem,wonReason:wonReason,lostReason:lostReason};return SidebarActions}]),angular.module("interloop.factory.relationshipManager",[]).factory("RelationshipManager",["$http","$q","Appuser","Logger","$injector","$uibModal",function($http,$q,Appuser,Logger,$injector,$uibModal){function getPrimary(entityLinks,entityType){return _.find(entityLinks,{entityType:entityType,isPrimary:!0})}function getFirst(entityLinks,entityType){return _.find(entityLinks,{entityType:entityType})}function getPrimaryOrFirst(entityLinks,entityType){var item=getPrimary(entityLinks,entityType);return item=_.isNil(item)?getFirst(entityLinks,entityType):item,item=item||null}function getTags(items,entityType){return _.filter(items,{itemType:"Tag"})||[]}function getEntities(entityType,entityId){var entityModel=$injector.get(entityType);return entityModel.prototype$__get__entities({id:entityId}).$promise}function getItems(entityType,entityId){var entityModel=$injector.get(entityType);return entityModel.prototype$__get__items({id:entityId}).$promise}function getActivities(entityType,entityId){var entityModel=$injector.get(entityType);return entityModel.prototype$__get__activities({id:entityId}).$promise}function linkEntity(entity,entityToLink,entityType,entityLinkType,relationship){var entityModel=$injector.get(entityType),entityLinkModel=$injector.get(entityLinkType);return entityLinkModel.prototype$__create__entities({id:entityToLink.id},{entityId:entity.id,entityType:entityType,name:_.get(relationship.from,"name",null),description:_.get(relationship.from,"description",null),isPrimary:_.get(relationship.from,"isPrimary",!1)}).$promise.then(function(results){return entityModel.prototype$__create__entities({id:entity.id},{entityId:entityToLink.id,entityType:entityLinkType,name:_.get(relationship.to,"name",null),description:_.get(relationship.to,"description",null),isPrimary:_.get(relationship.to,"isPrimary",!1)}).$promise})}function unlinkEntity(entity,entityLink,entityType,entityLinkType){var entityModel=$injector.get(entityType),entityLinkModel=$injector.get(entityLinkType);return entityModel.prototype$__destroyById__entities({id:_.get(entity,"id","NoID"),fk:_.get(entityLink,"id",null)}).$promise.then(function(results){return entityLinkModel.prototype$__get__entities({id:_.get(entityLink,"entityId",null),filter:{where:{entityId:entity.id}}}).$promise}).then(function(results){var otherEntityLink=results[0];return entityLinkModel.prototype$__destroyById__entities({id:_.get(entityLink,"entityId",null),fk:_.get(otherEntityLink,"id",null)}).$promise})}function linkActivity(activityId,linkItemId,linkEntityType,relationship){var linkEntityModel=$injector.get(linkEntityType),activityModel=$injector.get("Activity");return linkEntityModel.prototype$__create__activities({id:linkItemId},{activityId:activityId,name:_.get(relationship.activity,"name",null),type:_.get(relationship.activity,"type.value",null),completed:_.get(relationship.activity,"completed",!1)}).$promise.then(function(results){return activityModel.prototype$__create__entities({id:activityId},{entityId:linkItemId,entityType:linkEntityType,name:_.get(relationship.entity,"name",null),description:_.get(relationship.entity,"description",null),isPrimary:_.get(relationship.entity,"isPrimary",!1)}).$promise})}function unlinkActivity(activity,entityLink,entityLinkType){var entityLinkModel=$injector.get(entityLinkType),activityModel=$injector.get("Activity");return activityModel.prototype$__destroyById__entities({id:activity.id,fk:entityLink.id}).$promise.then(function(results){return entityLinkModel.prototype$__get__activities({id:entityLink.entityId,filter:{where:{activityId:activity.id}}}).$promise}).then(function(results){var otherEntityLink=results[0];return entityLinkModel.prototype$__destroyById__activities({id:entityLink.entityId,fk:otherEntityLink.id}).$promise})}function linkItem(entityItemId,linkItemId,entityType,linkItemType,relationship){var entityModel=$injector.get(entityType);return entityModel.prototype$__create__items({id:entityItemId},{itemId:linkItemId,itemType:linkItemType,name:_.get(relationship,"name",null),description:_.get(relationship,"description",null)}).$promise}function unlinkItem(entityItemId,linkItemId,entityType,linkItemType){var entityModel=$injector.get(entityType);return null!=entityItemId?entityModel.prototype$__destroyById__items({id:entityItemId,fk:linkItemId}).$promise:$q.when(null)}function linkReference(entityItemId,referenceItemId,entityType,referenceTypePlural){var entityModel=$injector.get(entityType);return entityModel[referenceTypePlural].link({id:entityItemId,fk:referenceItemId}).$promise}function unlinkReference(entityItemId,referenceItemId,entityType,referenceTypePlural){var entityModel=$injector.get(entityType);return null!=referenceItemId?entityModel[referenceTypePlural].unlink({id:entityItemId,fk:referenceItemId}).$promise:$q.when(null)}function relateToWizard(entityItem,entityType,relatedToEntities,picklists){var relateEntityModal=$uibModal.open({animation:!0,templateUrl:"shared/modals/relateEntity-modal.tpl.html",controller:"relateEntityCtrl",backdrop:"static",size:"lg",windowClass:"modal-fade-in-scale-up",resolve:{relatedToInfo:function(){return{currentEntity:entityItem,entityType:entityType,relatedToEntities:relatedToEntities,picklists:picklists}}}});return relateEntityModal.result}var RelationManager={getPrimary:getPrimary,getFirst:getFirst,getPrimaryOrFirst:getPrimaryOrFirst,getTags:getTags,getActivities:getActivities,getItems:getItems,getEntities:getEntities,linkEntity:linkEntity,unlinkEntity:unlinkEntity,linkItem:linkItem,unlinkItem:unlinkItem,linkActivity:linkActivity,unlinkActivity:unlinkActivity,linkReference:linkReference,unlinkReference:unlinkReference,relateToWizard:relateToWizard};return RelationManager}]),angular.module("interloop.factory.searchService",[]).factory("searchService",["$log","$uibModal","$q","$http","$injector","BASE","searchEntities","entityTypes",function($log,$uibModal,$q,$http,$injector,BASE,searchEntities,entityTypes){function globalSearch(query,grouped){var searchPromises=[];return _.forOwn(searchEntities,function(value,key){searchPromises.push($injector.get(value.singular).search({searchText:""+query}).$promise)}),$q.all(searchPromises).then(function(results){var searchItem={};if(grouped){var searchResults=[],index=0;return _.forOwn(searchEntities,function(value,key){searchItem={},searchItem.entityType=value.singular,searchItem.highScore=_.max(_.map(results[index],"score")),searchItem.results=results[index],searchResults.push(searchItem),index++}),_.sortBy(searchResults,["highScore"]).reverse()}var flattendResults=_.flattenDeep(_.map(results,"data"));return flattendResults})}function entitySearch(entity,query){var plural=entityTypes[entity.toLowerCase()].plural;return $http({method:"GET",url:BASE.URL+"/api/"+plural+'/search?txt="'+query+'"'}).then(function(response){return response.data})}var searchService={globalSearch:globalSearch,entitySearch:entitySearch};return searchService}]);